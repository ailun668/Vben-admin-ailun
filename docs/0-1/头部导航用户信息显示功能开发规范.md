# å¤´éƒ¨å¯¼èˆªç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºåŠŸèƒ½å¼€å‘è§„èŒƒ

> æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜é¡¹ç›®ä¸­å¤´éƒ¨å·¦ä¾§å¯¼èˆªæ ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºåŠŸèƒ½çš„å®ç°æ–¹å¼ã€æŠ€æœ¯æ¶æ„å’Œå¼€å‘è§„èŒƒ

## ğŸ“‹ ç›®å½•

- [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [å®ç°ç»†èŠ‚](#å®ç°ç»†èŠ‚)
- [ä»£ç ç»“æ„](#ä»£ç ç»“æ„)
- [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)
- [æ‰©å±•æŒ‡å—](#æ‰©å±•æŒ‡å—)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## åŠŸèƒ½æ¦‚è¿°

### åŠŸèƒ½æè¿°

å¤´éƒ¨å·¦ä¾§å¯¼èˆªæ ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºåŠŸèƒ½ä½äºåº”ç”¨ä¸»å¸ƒå±€çš„ä¾§è¾¹æ ï¼ˆ`a-layout-sider`ï¼‰åº•éƒ¨ï¼Œä¸»è¦åŒ…å«ï¼š

1. **ç”¨æˆ·åç§°æ˜¾ç¤º**ï¼šæ˜¾ç¤ºå½“å‰ç™»å½•ç”¨æˆ·çš„çœŸå®å§“åæˆ–ç”¨æˆ·å
2. **ç™»å‡ºåŠŸèƒ½**ï¼šæä¾›ç™»å‡ºæŒ‰é’®ï¼Œæ”¯æŒç”¨æˆ·å®‰å…¨é€€å‡ºç³»ç»Ÿ

### åŠŸèƒ½ç‰¹ç‚¹

- âœ… **å“åº”å¼è®¾è®¡**ï¼šæ”¯æŒä¾§è¾¹æ æŠ˜å /å±•å¼€çŠ¶æ€
- âœ… **çŠ¶æ€æŒä¹…åŒ–**ï¼šç”¨æˆ·ä¿¡æ¯è‡ªåŠ¨ä¿å­˜åˆ° localStorage
- âœ… **æƒé™é›†æˆ**ï¼šä¸æƒé™ç³»ç»Ÿæ— ç¼é›†æˆ
- âœ… **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- âœ… **çŠ¶æ€ç®¡ç†**ï¼šåŸºäº Pinia çš„é›†ä¸­å¼çŠ¶æ€ç®¡ç†

---

## æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Vue 3** | 3.5+ | å‰ç«¯æ¡†æ¶ |
| **TypeScript** | 5.9+ | ç±»å‹ç³»ç»Ÿ |
| **Pinia** | 3.0+ | çŠ¶æ€ç®¡ç† |
| **Ant Design Vue** | 4.2+ | UI ç»„ä»¶åº“ |
| **Vue Router** | 4.6+ | è·¯ç”±ç®¡ç† |

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    App.vue (ä¸»å¸ƒå±€)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         a-layout-sider (ä¾§è¾¹æ )                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Logo åŒºåŸŸ                                   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Menu èœå•åŒºåŸŸ                               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  user-info (ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ) â† æœ¬æ–‡æ¡£é‡ç‚¹       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ user-name (ç”¨æˆ·åæ˜¾ç¤º)                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ ç™»å‡ºæŒ‰é’®                                 â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              useUserStore (Pinia Store)                  â”‚
â”‚  â”œâ”€ userInfo: UserInfo | null                           â”‚
â”‚  â”œâ”€ token: string                                       â”‚
â”‚  â”œâ”€ userName: computed (è®¡ç®—å±æ€§)                       â”‚
â”‚  â”œâ”€ login()                                             â”‚
â”‚  â”œâ”€ logout()                                            â”‚
â”‚  â””â”€ getCurrentUser()                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  userApi (API å±‚)                        â”‚
â”‚  â”œâ”€ login()                                             â”‚
â”‚  â”œâ”€ getCurrentUser()                                    â”‚
â”‚  â””â”€ logout()                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®ç°ç»†èŠ‚

### 1. ç»„ä»¶ç»“æ„ (App.vue)

#### æ¨¡æ¿éƒ¨åˆ†

```vue
<a-layout-sider v-model:collapsed="collapsed" collapsible>
  <!-- Logo åŒºåŸŸ -->
  <div class="logo">
    <h2 style="color: white; margin: 0; font-size: 18px">My Enterprise</h2>
  </div>
  
  <!-- èœå•åŒºåŸŸ -->
  <a-menu ...>
    <!-- èœå•é¡¹ -->
  </a-menu>
  
  <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
  <div class="user-info">
    <div class="user-name">{{ userName }}</div>
    <a-button 
      type="text" 
      size="small" 
      @click="handleLogout" 
      style="color: white; width: 100%"
    >
      ç™»å‡º
    </a-button>
  </div>
</a-layout-sider>
```

#### è„šæœ¬éƒ¨åˆ†

```typescript
<script lang="ts" setup>
import { ref, computed } from 'vue'
import { useRouter, useRoute } from 'vue-router'
import { useUserStore } from '@/store/modules/user'
import { usePermissionStore } from '@/store/modules/permission'

const router = useRouter()
const route = useRoute()
const userStore = useUserStore()
const permissionStore = usePermissionStore()

// ç”¨æˆ·åè®¡ç®—å±æ€§
const userName = computed(() => {
  return userStore.userName || 'ç”¨æˆ·'
})

// ç™»å‡ºå¤„ç†
async function handleLogout() {
  await userStore.logout()
  permissionStore.resetPermission()
  resetRouteAdded()
  router.push('/login')
}
</script>
```

#### æ ·å¼éƒ¨åˆ†

```css
<style scoped>
.user-info {
  position: absolute;
  bottom: 0;
  width: 100%;
  padding: 16px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.user-name {
  color: white;
  font-size: 14px;
  margin-bottom: 8px;
  text-align: center;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
</style>
```

### 2. çŠ¶æ€ç®¡ç† (useUserStore)

#### Store å®šä¹‰

```typescript
// src/store/modules/user.ts
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import { userApi } from '@/api/user'
import type { UserInfo, LoginRequest } from '@/api/types'

export const useUserStore = defineStore(
  'user',
  () => {
    // çŠ¶æ€
    const token = ref<string>('')
    const userInfo = ref<UserInfo | null>(null)
    const loading = ref(false)

    // è®¡ç®—å±æ€§ï¼šç”¨æˆ·å
    const userName = computed(() => {
      return userInfo.value?.realName || userInfo.value?.username || ''
    })

    // è®¡ç®—å±æ€§ï¼šç”¨æˆ·è§’è‰²
    const userRoles = computed(() => {
      return userInfo.value?.roles || []
    })

    // è®¡ç®—å±æ€§ï¼šç”¨æˆ·æƒé™
    const userPermissions = computed(() => {
      return userInfo.value?.permissions || []
    })

    // ç™»å½•æ–¹æ³•
    async function login(loginData: LoginRequest) {
      loading.value = true
      try {
        const response = await userApi.login(loginData)
        token.value = response.data.token
        userInfo.value = response.data.user
        return response.data
      } finally {
        loading.value = false
      }
    }

    // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
    async function getCurrentUser() {
      loading.value = true
      try {
        const response = await userApi.getCurrentUser()
        userInfo.value = response.data
        return response.data
      } finally {
        loading.value = false
      }
    }

    // ç™»å‡ºæ–¹æ³•
    async function logout() {
      loading.value = true
      try {
        await userApi.logout()
      } catch (error) {
        console.error('ç™»å‡ºå¤±è´¥:', error)
      } finally {
        token.value = ''
        userInfo.value = null
        loading.value = false
      }
    }

    return {
      // çŠ¶æ€
      token,
      userInfo,
      loading,
      // è®¡ç®—å±æ€§
      userName,
      userRoles,
      userPermissions,
      // æ–¹æ³•
      login,
      getCurrentUser,
      logout
    }
  },
  {
    // æŒä¹…åŒ–é…ç½®
    persist: {
      enabled: true,
      strategies: [
        {
          key: 'user_store',
          storage: localStorage,
          paths: ['token', 'userInfo']
        }
      ]
    }
  }
)
```

### 3. API å±‚ (userApi)

```typescript
// src/api/user.ts
import { http } from './http'
import type { LoginRequest, LoginResponse, UserInfo } from './types'

export const userApi = {
  /**
   * ç™»å½•
   */
  login(params: LoginRequest) {
    return http.post<LoginResponse>('/user/login', params)
  },

  /**
   * è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
   */
  getCurrentUser() {
    return http.get<UserInfo>('/user/info')
  },

  /**
   * ç™»å‡º
   */
  logout() {
    return http.post('/user/logout')
  }
}
```

### 4. ç±»å‹å®šä¹‰

```typescript
// src/api/types.ts

/**
 * ç”¨æˆ·ä¿¡æ¯æ¥å£
 */
export interface UserInfo {
  id: string
  username: string
  realName: string
  email: string
  avatar: string
  roles: string[]
  permissions: string[]
}

/**
 * ç™»å½•è¯·æ±‚å‚æ•°
 */
export interface LoginRequest {
  username: string
  password: string
}

/**
 * ç™»å½•å“åº”æ•°æ®
 */
export interface LoginResponse {
  token: string
  user: UserInfo
}
```

---

## ä»£ç ç»“æ„

### æ–‡ä»¶ç»„ç»‡

```
src/
â”œâ”€â”€ App.vue                    # ä¸»å¸ƒå±€ç»„ä»¶ï¼ˆç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸï¼‰
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ user.ts               # ç”¨æˆ·ç›¸å…³ API
â”‚   â””â”€â”€ types.ts              # API ç±»å‹å®šä¹‰
â”œâ”€â”€ store/
â”‚   â””â”€â”€ modules/
â”‚       â””â”€â”€ user.ts           # ç”¨æˆ·çŠ¶æ€ç®¡ç†
â””â”€â”€ router/
    â””â”€â”€ index.ts              # è·¯ç”±é…ç½®
```

### å…³é”®æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶è·¯å¾„ | èŒè´£ | å…³é”®å†…å®¹ |
|---------|------|---------|
| `src/App.vue` | ä¸»å¸ƒå±€ç»„ä»¶ | ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º UIã€ç™»å‡ºå¤„ç† |
| `src/store/modules/user.ts` | ç”¨æˆ·çŠ¶æ€ç®¡ç† | ç”¨æˆ·ä¿¡æ¯çŠ¶æ€ã€ç™»å½•/ç™»å‡ºé€»è¾‘ |
| `src/api/user.ts` | API æ¥å£ | ç”¨æˆ·ç›¸å…³ HTTP è¯·æ±‚ |
| `src/api/types.ts` | ç±»å‹å®šä¹‰ | UserInfoã€LoginRequest ç­‰ç±»å‹ |

---

## å¼€å‘è§„èŒƒ

### 1. ç»„ä»¶å¼€å‘è§„èŒƒ

#### âœ… æ¨èåšæ³•

1. **ä½¿ç”¨ Composition API**
   ```vue
   <script lang="ts" setup>
   // ä½¿ç”¨ <script setup> è¯­æ³•
   </script>
   ```

2. **ä½¿ç”¨è®¡ç®—å±æ€§è·å–ç”¨æˆ·ä¿¡æ¯**
   ```typescript
   const userName = computed(() => {
     return userStore.userName || 'ç”¨æˆ·'
   })
   ```

3. **ä½¿ç”¨ TypeScript ç±»å‹**
   ```typescript
   import type { UserInfo } from '@/api/types'
   ```

4. **é”™è¯¯å¤„ç†**
   ```typescript
   async function handleLogout() {
     try {
       await userStore.logout()
     } catch (error) {
       console.error('ç™»å‡ºå¤±è´¥:', error)
       // é”™è¯¯æç¤º
     }
   }
   ```

#### âŒ é¿å…åšæ³•

1. **ä¸è¦ç›´æ¥ä¿®æ”¹ Store çŠ¶æ€**
   ```typescript
   // âŒ é”™è¯¯
   userStore.userInfo = newUserInfo
   
   // âœ… æ­£ç¡®
   userStore.setUserInfo(newUserInfo)
   ```

2. **ä¸è¦åœ¨ç»„ä»¶ä¸­ç›´æ¥è°ƒç”¨ API**
   ```typescript
   // âŒ é”™è¯¯
   const userInfo = await userApi.getCurrentUser()
   
   // âœ… æ­£ç¡®
   const userInfo = await userStore.getCurrentUser()
   ```

3. **ä¸è¦ç¡¬ç¼–ç ç”¨æˆ·ä¿¡æ¯**
   ```typescript
   // âŒ é”™è¯¯
   const userName = 'ç®¡ç†å‘˜'
   
   // âœ… æ­£ç¡®
   const userName = computed(() => userStore.userName)
   ```

### 2. Store å¼€å‘è§„èŒƒ

#### âœ… æ¨èåšæ³•

1. **ä½¿ç”¨è®¡ç®—å±æ€§æ´¾ç”ŸçŠ¶æ€**
   ```typescript
   const userName = computed(() => {
     return userInfo.value?.realName || userInfo.value?.username || ''
   })
   ```

2. **ä½¿ç”¨æŒä¹…åŒ–æ’ä»¶**
   ```typescript
   {
     persist: {
       enabled: true,
       strategies: [
         {
           key: 'user_store',
           storage: localStorage,
           paths: ['token', 'userInfo']
         }
       ]
     }
   }
   ```

3. **ç»Ÿä¸€é”™è¯¯å¤„ç†**
   ```typescript
   async function logout() {
     loading.value = true
     try {
       await userApi.logout()
     } catch (error) {
       console.error('ç™»å‡ºå¤±è´¥:', error)
     } finally {
       // æ— è®ºæˆåŠŸå¤±è´¥éƒ½æ¸…é™¤æœ¬åœ°æ•°æ®
       token.value = ''
       userInfo.value = null
       loading.value = false
     }
   }
   ```

### 3. API å¼€å‘è§„èŒƒ

#### âœ… æ¨èåšæ³•

1. **ä½¿ç”¨ç±»å‹å®šä¹‰**
   ```typescript
   login(params: LoginRequest): Promise<ApiResponse<LoginResponse>>
   ```

2. **ç»Ÿä¸€é”™è¯¯å¤„ç†**
   ```typescript
   // åœ¨ http æ‹¦æˆªå™¨ä¸­ç»Ÿä¸€å¤„ç†
   ```

3. **ä½¿ç”¨ JSDoc æ³¨é‡Š**
   ```typescript
   /**
    * ç™»å½•
    * @param params ç™»å½•å‚æ•°
    * @returns ç™»å½•å“åº”
    */
   login(params: LoginRequest) {
     return http.post<LoginResponse>('/user/login', params)
   }
   ```

### 4. æ ·å¼å¼€å‘è§„èŒƒ

#### âœ… æ¨èåšæ³•

1. **ä½¿ç”¨ scoped æ ·å¼**
   ```vue
   <style scoped>
   .user-info {
     /* æ ·å¼ */
   }
   </style>
   ```

2. **å“åº”å¼è®¾è®¡**
   ```css
   .user-name {
     overflow: hidden;
     text-overflow: ellipsis;
     white-space: nowrap;
   }
   ```

3. **ä½¿ç”¨ CSS å˜é‡ï¼ˆå¦‚éœ€è¦ä¸»é¢˜åˆ‡æ¢ï¼‰**
   ```css
   .user-name {
     color: var(--text-color);
   }
   ```

---

## æ‰©å±•æŒ‡å—

### 1. æ·»åŠ ç”¨æˆ·å¤´åƒæ˜¾ç¤º

#### ä¿®æ”¹ App.vue

```vue
<div class="user-info">
  <!-- æ·»åŠ å¤´åƒ -->
  <a-avatar 
    :src="userStore.userInfo?.avatar" 
    :size="40"
    style="margin-bottom: 8px"
  >
    <template #icon>
      <UserOutlined />
    </template>
  </a-avatar>
  
  <div class="user-name">{{ userName }}</div>
  <a-button 
    type="text" 
    size="small" 
    @click="handleLogout" 
    style="color: white; width: 100%"
  >
    ç™»å‡º
  </a-button>
</div>
```

#### ä¿®æ”¹æ ·å¼

```css
.user-info {
  position: absolute;
  bottom: 0;
  width: 100%;
  padding: 16px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  display: flex;
  flex-direction: column;
  align-items: center;
}
```

### 2. æ·»åŠ ç”¨æˆ·ä¸‹æ‹‰èœå•

#### ä½¿ç”¨ Ant Design Vue çš„ Dropdown

```vue
<a-dropdown placement="top">
  <div class="user-info-trigger">
    <a-avatar :src="userStore.userInfo?.avatar" :size="32" />
    <span class="user-name">{{ userName }}</span>
  </div>
  <template #overlay>
    <a-menu>
      <a-menu-item key="profile">
        <UserOutlined />
        ä¸ªäººä¸­å¿ƒ
      </a-menu-item>
      <a-menu-item key="settings">
        <SettingOutlined />
        è®¾ç½®
      </a-menu-item>
      <a-menu-divider />
      <a-menu-item key="logout" @click="handleLogout">
        <LogoutOutlined />
        ç™»å‡º
      </a-menu-item>
    </a-menu>
  </template>
</a-dropdown>
```

### 3. æ·»åŠ ç”¨æˆ·çŠ¶æ€æŒ‡ç¤ºå™¨

```vue
<div class="user-info">
  <div class="user-status">
    <a-avatar :src="userStore.userInfo?.avatar" :size="32" />
    <span class="status-dot" :class="{ online: isOnline }"></span>
  </div>
  <div class="user-name">{{ userName }}</div>
</div>
```

```css
.user-status {
  position: relative;
  margin-bottom: 8px;
}

.status-dot {
  position: absolute;
  bottom: 0;
  right: 0;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: #ccc;
  border: 2px solid white;
}

.status-dot.online {
  background: #52c41a;
}
```

### 4. æ·»åŠ ç”¨æˆ·è§’è‰²æ˜¾ç¤º

```vue
<div class="user-info">
  <div class="user-name">{{ userName }}</div>
  <div class="user-roles">
    <a-tag 
      v-for="role in userStore.userRoles" 
      :key="role"
      size="small"
      color="blue"
    >
      {{ role }}
    </a-tag>
  </div>
  <a-button type="text" size="small" @click="handleLogout">
    ç™»å‡º
  </a-button>
</div>
```

---

## å¸¸è§é—®é¢˜

### Q1: ç”¨æˆ·ä¿¡æ¯ä¸æ˜¾ç¤ºï¼Ÿ

**åŸå› åˆ†æ**ï¼š
1. Store ä¸­ç”¨æˆ·ä¿¡æ¯ä¸ºç©º
2. è®¡ç®—å±æ€§é€»è¾‘é”™è¯¯
3. æŒä¹…åŒ–æ•°æ®æœªæ­£ç¡®æ¢å¤

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// æ£€æŸ¥ Store çŠ¶æ€
console.log('userInfo:', userStore.userInfo)
console.log('userName:', userStore.userName)

// ç¡®ä¿åœ¨åº”ç”¨å¯åŠ¨æ—¶æ¢å¤ç”¨æˆ·ä¿¡æ¯
onMounted(async () => {
  if (userStore.token && !userStore.userInfo) {
    await userStore.getCurrentUser()
  }
})
```

### Q2: ç™»å‡ºåç”¨æˆ·ä¿¡æ¯ä»ç„¶æ˜¾ç¤ºï¼Ÿ

**åŸå› åˆ†æ**ï¼š
1. Store çŠ¶æ€æœªæ­£ç¡®æ¸…é™¤
2. è·¯ç”±è·³è½¬å¤±è´¥
3. æŒä¹…åŒ–æ•°æ®æœªæ¸…é™¤

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
async function handleLogout() {
  try {
    await userStore.logout()
    // æ¸…é™¤æŒä¹…åŒ–æ•°æ®
    localStorage.removeItem('user_store')
    // é‡ç½®æƒé™
    permissionStore.resetPermission()
    // è·³è½¬åˆ°ç™»å½•é¡µ
    router.push('/login')
  } catch (error) {
    console.error('ç™»å‡ºå¤±è´¥:', error)
  }
}
```

### Q3: ä¾§è¾¹æ æŠ˜å æ—¶ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºå¼‚å¸¸ï¼Ÿ

**åŸå› åˆ†æ**ï¼š
1. å›ºå®šå®šä½å¯¼è‡´å¸ƒå±€é—®é¢˜
2. å®½åº¦è®¡ç®—é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```css
.user-info {
  position: absolute;
  bottom: 0;
  width: 100%;
  padding: 16px;
  box-sizing: border-box;
}

/* æŠ˜å çŠ¶æ€ä¸‹çš„æ ·å¼ */
.ant-layout-sider-collapsed .user-info {
  padding: 8px;
}

.ant-layout-sider-collapsed .user-name {
  display: none; /* æˆ–ä½¿ç”¨å›¾æ ‡ä»£æ›¿ */
}
```

### Q4: å¦‚ä½•å®ç°ç”¨æˆ·ä¿¡æ¯å®æ—¶æ›´æ–°ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// åœ¨ Store ä¸­æ·»åŠ æ›´æ–°æ–¹æ³•
async function updateUserInfo() {
  try {
    const response = await userApi.getCurrentUser()
    userInfo.value = response.data
  } catch (error) {
    console.error('æ›´æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)
  }
}

// åœ¨ç»„ä»¶ä¸­å®šæœŸåˆ·æ–°
onMounted(() => {
  // æ¯ 5 åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡ç”¨æˆ·ä¿¡æ¯
  const timer = setInterval(() => {
    userStore.updateUserInfo()
  }, 5 * 60 * 1000)
  
  onUnmounted(() => {
    clearInterval(timer)
  })
})
```

---

## æœ€ä½³å®è·µæ€»ç»“

### âœ… æ¨èåšæ³•

1. **ä½¿ç”¨ Pinia Store ç®¡ç†ç”¨æˆ·çŠ¶æ€**
2. **ä½¿ç”¨è®¡ç®—å±æ€§æ´¾ç”Ÿæ˜¾ç¤ºæ•°æ®**
3. **å®ç°çŠ¶æ€æŒä¹…åŒ–**
4. **ç»Ÿä¸€é”™è¯¯å¤„ç†**
5. **ä½¿ç”¨ TypeScript ç¡®ä¿ç±»å‹å®‰å…¨**
6. **å“åº”å¼è®¾è®¡ï¼Œé€‚é…ä¸åŒå±å¹•å°ºå¯¸**

### âŒ é¿å…åšæ³•

1. **ä¸è¦åœ¨ç»„ä»¶ä¸­ç›´æ¥æ“ä½œ API**
2. **ä¸è¦ç¡¬ç¼–ç ç”¨æˆ·ä¿¡æ¯**
3. **ä¸è¦å¿½ç•¥é”™è¯¯å¤„ç†**
4. **ä¸è¦å¿˜è®°æ¸…é™¤æ•æ„Ÿæ•°æ®**

---

## å‚è€ƒèµ„æ–™

- [Vue 3 å®˜æ–¹æ–‡æ¡£](https://vuejs.org/)
- [Pinia å®˜æ–¹æ–‡æ¡£](https://pinia.vuejs.org/)
- [Ant Design Vue å®˜æ–¹æ–‡æ¡£](https://antdv.com/)
- [Vue Router å®˜æ–¹æ–‡æ¡£](https://router.vuejs.org/)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-01-15  
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ

