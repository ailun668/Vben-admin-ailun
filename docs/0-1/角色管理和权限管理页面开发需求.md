# 角色管理和权限管理页面开发需求

> **需求版本**: v1.0  
> **创建日期**: 2025-01-15  
> **需求来源**: 基于技术规范完善现有页面  
> **优先级**: 高

---

## 📋 需求概述

将现有的**角色管理**（RolesView.vue）和**权限管理**（PermissionsView.vue）页面按照《AI开发技术规范-基于Crud组件的页面开发.md》进行重构，使其符合项目统一的技术规范和代码标准。

---

## 🎯 需求目标

### 1. 技术规范对齐
- ✅ 使用 `Crud` 核心组件替代原生 `a-table`
- ✅ 采用配置驱动开发模式（`LocalCrudConfig`）
- ✅ 实现完整的 CRUD 功能（增删改查）
- ✅ 遵循项目统一的代码规范和结构

### 2. 功能完整性
- ✅ 搜索功能
- ✅ 分页功能
- ✅ 新增功能（抽屉/模态框）
- ✅ 编辑功能（表单模态框）
- ✅ 删除功能（确认对话框）
- ✅ 数据展示优化

---

## 📝 详细需求

### 需求 1: 角色管理页面（RolesView.vue）

#### 1.1 页面结构
- **主页面**: `src/views/RolesView/RolesView.vue`
- **新增组件**: `src/views/RolesView/AddRoleDrawer.vue`

#### 1.2 数据模型
```typescript
interface Role {
  id: string                    // 角色ID
  name: string                  // 角色名称（如：admin, user）
  code: string                  // 角色代码
  description: string           // 角色描述
  permissions: string[]         // 权限列表（权限ID数组）
  userCount: number            // 关联用户数
  status: 'active' | 'inactive' // 状态
  createTime: string           // 创建时间
  updateTime: string           // 更新时间
}
```

#### 1.3 功能需求

**1.3.1 列表展示**
- 表格列：ID、角色名称、角色代码、描述、权限数、用户数、状态、创建时间、操作
- 支持排序（按创建时间、用户数）
- 支持分页（每页 10/20/50/100 条）
- 状态显示为 Badge（活跃/停用）

**1.3.2 搜索功能**
- 搜索字段：角色名称、角色代码、描述
- 筛选字段：状态（活跃/停用）

**1.3.3 新增功能**
- 工具栏按钮："新增角色"
- 打开抽屉组件 `AddRoleDrawer`
- 表单字段：
  - 角色名称（必填）
  - 角色代码（必填，唯一）
  - 描述（可选）
  - 权限选择（多选，必填）
  - 状态（必填，默认：活跃）

**1.3.4 编辑功能**
- 操作列按钮："编辑"
- 打开表单抽屉，回显当前行数据
- 表单字段同新增（ID 字段只读）
- 提交后刷新列表

**1.3.5 删除功能**
- 操作列按钮："删除"（危险按钮）
- 确认对话框："是否确认删除角色 "{角色名称}"?"
- 删除成功后刷新列表

**1.3.6 数据展示优化**
- 权限数：显示为数字
- 用户数：显示为数字
- 权限列表：显示为 Tag 标签组（可选，在详情中展示）

#### 1.4 模拟数据
- 生成 20-30 条模拟角色数据
- 包含：admin, user, editor, viewer 等常见角色
- 每个角色关联不同的权限组合

---

### 需求 2: 权限管理页面（PermissionsView.vue）

#### 2.1 页面结构
- **主页面**: `src/views/PermissionsView/PermissionsView.vue`
- **新增组件**: `src/views/PermissionsView/AddPermissionDrawer.vue`

#### 2.2 数据模型
```typescript
interface Permission {
  id: string                    // 权限ID
  name: string                  // 权限名称（如：user.view）
  code: string                  // 权限代码
  description: string           // 权限描述
  resource: string              // 资源（如：user, role, permission）
  action: string                // 操作（如：view, create, edit, delete）
  category: string              // 分类（如：用户管理、角色管理）
  status: 'active' | 'inactive' // 状态
  createTime: string           // 创建时间
  updateTime: string           // 更新时间
}
```

#### 2.3 功能需求

**2.3.1 列表展示**
- 表格列：ID、权限名称、权限代码、描述、资源、操作、分类、状态、创建时间、操作
- 支持排序（按创建时间、资源）
- 支持分页（每页 10/20/50/100 条）
- 状态显示为 Badge（活跃/停用）

**2.3.2 搜索功能**
- 搜索字段：权限名称、权限代码、描述
- 筛选字段：
  - 资源（下拉选择：user, role, permission 等）
  - 操作（下拉选择：view, create, edit, delete）
  - 状态（活跃/停用）

**2.3.3 新增功能**
- 工具栏按钮："新增权限"
- 打开抽屉组件 `AddPermissionDrawer`
- 表单字段：
  - 权限名称（必填）
  - 权限代码（必填，唯一，格式：resource.action）
  - 描述（可选）
  - 资源（必填，下拉选择）
  - 操作（必填，下拉选择）
  - 分类（可选，输入框）
  - 状态（必填，默认：活跃）

**2.3.4 编辑功能**
- 操作列按钮："编辑"
- 打开表单抽屉，回显当前行数据
- 表单字段同新增（ID 字段只读）
- 提交后刷新列表

**2.3.5 删除功能**
- 操作列按钮："删除"（危险按钮）
- 确认对话框："是否确认删除权限 "{权限名称}"?"
- 删除成功后刷新列表

#### 2.4 模拟数据
- 生成 30-40 条模拟权限数据
- 涵盖常见资源：user, role, permission
- 涵盖常见操作：view, create, edit, delete
- 按资源分组展示

---

## 🔧 技术实现要求

### 必须遵循的技术规范

1. **配置驱动开发**
   - 使用 `LocalCrudConfig` 配置对象
   - 使用 `computed` 确保响应式
   - 配置对象是唯一真实数据源

2. **共享表单 Schema**
   - Add 和 Edit 共用同一个 Schema
   - ID 字段设为 `disabled: true`

3. **数据代理模式**
   - 使用 `proxyConfig.ajax.query` 处理数据
   - 支持搜索过滤和分页
   - 生成模拟数据函数

4. **操作配置**
   - 编辑操作使用 `apiConfig` 模式
   - 实现 `hooks.onOpened` 数据回显
   - 实现 `hooks.beforeSubmit` 数据转换
   - 实现 `hooks.onSubmitSuccess` 刷新列表

5. **样式规范**
   - 添加 VXE Table 对齐修复样式
   - 使用 `minWidth` 而非固定 `width`
   - 操作列使用固定 `width` 并 `fixed: 'right'`

6. **类型安全**
   - 所有配置使用 TypeScript 类型
   - 避免使用 `any` 类型
   - Props 和 Emits 明确类型定义

---

## ✅ 验收标准

### 功能验收
- [ ] 列表数据正确展示
- [ ] 搜索功能正常工作
- [ ] 分页功能正常工作
- [ ] 新增功能完整（表单验证、提交、刷新）
- [ ] 编辑功能完整（数据回显、提交、刷新）
- [ ] 删除功能完整（确认、删除、刷新）

### 技术验收
- [ ] 使用 Crud 组件而非原生 a-table
- [ ] 配置对象使用 `computed` 定义
- [ ] 共享表单 Schema 实现
- [ ] 数据代理模式实现
- [ ] 操作钩子函数完整实现
- [ ] 样式规范遵循（VXE Table 对齐修复）
- [ ] TypeScript 类型定义完整
- [ ] 代码符合项目规范

### UI/UX 验收
- [ ] 页面布局合理
- [ ] 表格对齐正确
- [ ] 按钮和操作符合 Ant Design 规范
- [ ] 响应式设计良好
- [ ] 错误提示友好

---

## 📅 开发计划

1. **阶段一：角色管理页面**（优先级：高）
   - 创建目录结构
   - 实现主页面（RolesView.vue）
   - 实现新增组件（AddRoleDrawer.vue）
   - 实现模拟数据生成
   - 测试验证

2. **阶段二：权限管理页面**（优先级：高）
   - 创建目录结构
   - 实现主页面（PermissionsView.vue）
   - 实现新增组件（AddPermissionDrawer.vue）
   - 实现模拟数据生成
   - 测试验证

---

## 📚 参考资源

- **技术规范**: `docs/技术规范/AI开发技术规范-基于Crud组件的页面开发.md`
- **参考示例**: `src/views/UsersView/UsersView.vue`
- **组件文档**: `docs/核心组件/0-Crud组件开发指南.md`

---

## 📝 备注

- 当前两个页面使用原生 `a-table`，需要完全重构
- 模拟数据需要足够丰富，覆盖各种场景
- 权限选择需要支持多选，建议使用 TreeSelect 组件
- 所有操作需要友好的用户提示（成功/失败）

---

**需求文档结束**

