---
name: vue-payment-architect
description: Expert Vue 3 fullstack architect for fintech payment platforms. Specializes in secure transaction flows, KYC/AML compliance, real-time state management, offline-first architecture, and Indian payment ecosystem (UPI, RBI regulations). Builds production-grade payment systems with PCI-DSS compliance, high concurrency handling, and resilience for low-bandwidth networks.
---

# Vueæ”¯ä»˜å¹³å°å…¨æ ˆæ¶æ„æŒ‡å—

## æ ¸å¿ƒä»·å€¼ä¸å®šä½

### ä»€ä¹ˆæ˜¯è¿™ä¸ªSkill

è¿™ä¸ªSkillæ˜¯ä¸€ä»½**é‡‘èçº§åˆ«çš„Vue 3å…¨æ ˆå¼€å‘æŒ‡å—**ï¼Œä¸“æ³¨äºæ„å»º**æ”¯ä»˜å¹³å°ç³»ç»Ÿ**çš„å‰ç«¯æ¶æ„å’Œå·¥ç¨‹å®ç°ã€‚å®ƒä¸ä»…ä»…æ˜¯ä»£ç ç‰‡æ®µåº“ï¼Œè€Œæ˜¯ä¸€å¥—å®Œæ•´çš„æ–¹æ³•è®ºï¼Œæ¶µç›–ï¼š

- ğŸ—ï¸ **æ¶æ„è®¾è®¡** - ä»é›¶å¼€å§‹è§„åˆ’æ”¯ä»˜å¹³å°çš„å‰ç«¯ç»“æ„
- ğŸ” **é‡‘èå®‰å…¨** - PCI-DSSåˆè§„ã€æ•æ„Ÿæ•°æ®åŠ å¯†ã€å®¡è®¡æ—¥å¿—
- âš¡ **é«˜æ€§èƒ½** - é«˜å¹¶å‘æ”¯ä»˜ã€ä½å»¶è¿Ÿå®æ—¶æ›´æ–°ã€ä½å¸¦å®½ä¼˜åŒ–
- ğŸŒ **å°åº¦æœ¬åœ°åŒ–** - UPIæ”¯æŒã€å¤šè¯­è¨€ã€RBIåˆè§„ã€ç¦»çº¿å¼¹æ€§
- ğŸ“Š **çŠ¶æ€ç®¡ç†** - å¤æ‚çš„æ”¯ä»˜çŠ¶æ€æœºã€äº‹åŠ¡ä¸€è‡´æ€§
- ğŸ›¡ï¸ **å®¹é”™èƒ½åŠ›** - ç½‘ç»œä¸ç¨³å®šä¸‹çš„ä¼˜é›…é™çº§ã€ç¦»çº¿-åœ¨çº¿æ— ç¼åŒæ­¥

### ä½•æ—¶ä½¿ç”¨è¿™ä¸ªSkill

âœ… **æ­£ç¡®çš„åœºæ™¯**ï¼š
- ä»é›¶å¼€å§‹æ„å»ºæ”¯ä»˜å¹³å°å‰ç«¯
- é‡æ„ç°æœ‰æ”¯ä»˜ç³»ç»Ÿçš„æ¶æ„
- æ·»åŠ æ–°çš„æ”¯ä»˜åŠŸèƒ½ï¼ˆKYCã€è½¬è´¦ã€ç†è´¢ç­‰ï¼‰
- è§£å†³é«˜å¹¶å‘æˆ–å®‰å…¨ç›¸å…³çš„é—®é¢˜
- é€‚é…å°åº¦å¸‚åœºï¼ˆUPIã€å¤šè¯­è¨€ã€ä½ç½‘ç»œï¼‰

âŒ **ä¸é€‚åˆçš„åœºæ™¯**ï¼š
- ç®€å•çš„ä»£ç ç‰‡æ®µæŸ¥è¯¢ï¼ˆç”¨é€šç”¨çš„Vueæ–‡æ¡£å³å¯ï¼‰
- éé‡‘èç›¸å…³çš„ä¸šåŠ¡éœ€æ±‚
- ä»…éœ€è¦UIç»„ä»¶çš„é¡¹ç›®

---

## ç¬¬ä¸€ç« ï¼šæ”¯ä»˜å¹³å°æ¶æ„åŸºç¡€

### æ”¯ä»˜ç³»ç»Ÿçš„ä¸‰å¤§æ”¯æŸ±

æ”¯ä»˜å¹³å°çš„å‰ç«¯æ¶æ„å›´ç»•ä¸‰ä¸ªæ ¸å¿ƒæ”¯æŸ±å±•å¼€ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ”¯ä»˜å¹³å°å‰ç«¯æ¶æ„ä¸‰å¤§æ”¯æŸ±                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ğŸ” å®‰å…¨æ€§ (Security)                                    â”‚
â”‚  â”œâ”€ PCI-DSSåˆè§„: å¡å·ã€å¯†ç ã€OTPä»ä¸åœ¨å‰ç«¯å­˜å‚¨          â”‚
â”‚  â”œâ”€ åŠ å¯†ä¼ è¾“: HTTPS + TLS 1.3, å­—æ®µçº§åŠ å¯†              â”‚
â”‚  â”œâ”€ æ— æ—¥å¿—åŸåˆ™: ä¸è®°å½•æ•æ„Ÿæ•°æ®åˆ°ä»»ä½•åœ°æ–¹               â”‚
â”‚  â””â”€ å‰ç«¯é˜²æŠ¤: XSSã€CSRFã€ä¸­é—´äººæ”»å‡»é˜²æŠ¤                â”‚
â”‚                                                          â”‚
â”‚  âš¡ é«˜å¹¶å‘ (High Concurrency)                           â”‚
â”‚  â”œâ”€ ç§’æ€åœºæ™¯: æ”¯ä»˜é«˜å³°æœŸçš„æµé‡æ§åˆ¶                     â”‚
â”‚  â”œâ”€ å®æ—¶çŠ¶æ€: WebSocketè¿æ¥çš„ç®¡ç†å’Œé‡è¿æœºåˆ¶           â”‚
â”‚  â”œâ”€ ä¹è§‚æ›´æ–°: å‰ç«¯å…ˆæ›´æ–°ï¼Œåç«¯ç¡®è®¤                     â”‚
â”‚  â””â”€ ç«æ€æ¡ä»¶: é˜²æ­¢é‡å¤æ”¯ä»˜çš„å¹‚ç­‰æ€§è®¾è®¡                â”‚
â”‚                                                          â”‚
â”‚  ğŸŒ å®æ—¶æ€§ (Real-time Responsiveness)                  â”‚
â”‚  â”œâ”€ ä½™é¢åŒæ­¥: å®æ—¶åæ˜ è´¦æˆ·ä½™é¢å˜åŒ–                     â”‚
â”‚  â”œâ”€ äº¤æ˜“çŠ¶æ€: æ”¯ä»˜è¿‡ç¨‹çš„æ¯ä¸€æ­¥éƒ½æœ‰åé¦ˆ                â”‚
â”‚  â”œâ”€ é£é™©æç¤º: å¼‚å¸¸æ´»åŠ¨çš„å®æ—¶å‘Šè­¦                       â”‚
â”‚  â””â”€ ç¦»çº¿ä¼˜å…ˆ: ç½‘ç»œä¸­æ–­æ—¶çš„æœ¬åœ°ç¼“å­˜å’ŒåŒæ­¥              â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Vue 3åœ¨æ”¯ä»˜å¹³å°ä¸­çš„è§’è‰²

Vue 3çš„Composition APIç‰¹åˆ«é€‚åˆæ”¯ä»˜ç³»ç»Ÿï¼š

| ç‰¹æ€§ | æ”¯ä»˜åœºæ™¯ | Vue 3ä¼˜åŠ¿ |
|------|---------|----------|
| **å“åº”å¼çŠ¶æ€** | å®æ—¶ä½™é¢æ›´æ–°ã€äº¤æ˜“çŠ¶æ€ | ç»†ç²’åº¦å“åº”æ€§ï¼Œé¿å…ä¸å¿…è¦é‡æ¸²æŸ“ |
| **ç»„åˆå¼å‡½æ•°** | KYCã€æ”¯ä»˜ã€ç»“ç®—ç­‰ç‹¬ç«‹æµç¨‹ | é€»è¾‘å¤ç”¨ï¼Œæ˜“äºæµ‹è¯• |
| **TypeScript** | ç¡®ä¿ç±»å‹å®‰å…¨ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯ | ä¸¥æ ¼æ¨¡å¼ä¸‹çš„å®Œç¾æ”¯æŒ |
| **Teleport** | æ¨¡æ€å¯¹è¯æ¡†ã€é£é™©æç¤º | é¿å…z-indexæ··ä¹± |
| **Suspense** | å¼‚æ­¥æ•°æ®åŠ è½½ï¼ˆKYCå®¡æ ¸ç»“æœï¼‰ | ä¼˜é›…çš„åŠ è½½çŠ¶æ€ |

### RBIä¸NPCIçš„å…³é”®è¦æ±‚

æ”¯ä»˜å¹³å°å¿…é¡»æ»¡è¶³çš„æ ¸å¿ƒè¦æ±‚ï¼š

```yaml
RBI (å°åº¦å¤®è¡Œ) è¦æ±‚:
  æ•°æ®æœ¬åœ°åŒ–: æ‰€æœ‰ç”¨æˆ·æ•°æ®å¿…é¡»å­˜å‚¨åœ¨å°åº¦æœåŠ¡å™¨
  åŠ å¯†å¼ºåº¦: AES-256ç”¨äºæ•æ„Ÿæ•°æ®
  å®¡è®¡æ—¥å¿—: 6å¹´ä»¥ä¸Šçš„å®Œæ•´å®¡è®¡æ—¥å¿—
  èº«ä»½éªŒè¯: å¼ºèº«ä»½éªŒè¯ï¼Œå¦‚OTPã€ç”Ÿç‰©è¯†åˆ«
  é£é™©ç®¡ç†: å®æ—¶åæ¬ºè¯ˆå’ŒAMLæ£€æµ‹

NPCI (å›½å®¶æ”¯ä»˜å…¬å¸) UPIè¦æ±‚:
  äº¤æ˜“è¶…æ—¶: 5åˆ†é’Ÿå†…å®Œæˆæˆ–å¤±è´¥
  é‡è¯•æœºåˆ¶: è‡ªåŠ¨é‡è¯•3æ¬¡ï¼Œé—´éš”10ç§’
  é‡‘é¢é™é¢: å•ç¬”æ”¯ä»˜é™é¢â‚¹100,000
  äº¤æ˜“é¢‘ç‡: é™åˆ¶å¼‚å¸¸é¢‘ç¹çš„äº¤æ˜“
```

---

## ç¬¬äºŒç« ï¼šæ”¯ä»˜å¹³å°é¡¹ç›®æ¶æ„

### æ¨èçš„é¡¹ç›®ç»“æ„

```
payment-platform/
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ features/                    # åŠŸèƒ½æ¨¡å—ï¼ˆæŒ‰ä¸šåŠ¡åŸŸç»„ç»‡ï¼‰
â”‚   â”‚   â”œâ”€â”€ auth/                    # èº«ä»½è®¤è¯ä¸KYC
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LoginForm.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ OTPVerify.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ KYCUpload.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ composables/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ useKYC.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ authStore.ts
â”‚   â”‚   â”‚   â””â”€â”€ types/
â”‚   â”‚   â”‚       â””â”€â”€ auth.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ wallet/                  # é’±åŒ…ä¸ä½™é¢ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WalletCard.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ BalanceDisplay.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ RechargeModal.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ composables/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useWallet.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ useBalance.ts
â”‚   â”‚   â”‚   â””â”€â”€ stores/
â”‚   â”‚   â”‚       â””â”€â”€ walletStore.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ transaction/             # äº¤æ˜“ç®¡ç†ï¼ˆæ”¯ä»˜ã€è½¬è´¦ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PaymentForm.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TransactionStatus.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ TransactionHistory.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ composables/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ usePayment.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ useTransactionState.ts
â”‚   â”‚   â”‚   â””â”€â”€ stores/
â”‚   â”‚   â”‚       â””â”€â”€ transactionStore.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ risk-control/            # é£é™©æ§åˆ¶ä¸åæ¬ºè¯ˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ composables/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useRiskDetection.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ useAnomalyAlert.ts
â”‚   â”‚   â”‚   â””â”€â”€ stores/
â”‚   â”‚   â”‚       â””â”€â”€ riskStore.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ settlement/              # æ¸…ç®—ä¸å¯¹è´¦
â”‚   â”‚       â”œâ”€â”€ composables/
â”‚   â”‚       â”‚   â””â”€â”€ useSettlement.ts
â”‚   â”‚       â””â”€â”€ stores/
â”‚   â”‚           â””â”€â”€ settlementStore.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ shared/                      # å…±äº«åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ security/                # å®‰å…¨ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ encryption.ts        # åŠ å¯†/è§£å¯†å·¥å…·
â”‚   â”‚   â”‚   â”œâ”€â”€ audit.ts             # å®¡è®¡æ—¥å¿—
â”‚   â”‚   â”‚   â””â”€â”€ validation.ts        # è¾“å…¥éªŒè¯
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ realtime/                # å®æ—¶é€šä¿¡
â”‚   â”‚   â”‚   â”œâ”€â”€ websocket.ts         # WebSocketç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ reconnect.ts         # è‡ªåŠ¨é‡è¿
â”‚   â”‚   â”‚   â””â”€â”€ handlers.ts          # æ¶ˆæ¯å¤„ç†å™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ offline/                 # ç¦»çº¿æ”¯æŒ
â”‚   â”‚   â”‚   â”œâ”€â”€ sync.ts              # æ•°æ®åŒæ­¥
â”‚   â”‚   â”‚   â”œâ”€â”€ storage.ts           # æœ¬åœ°å­˜å‚¨
â”‚   â”‚   â”‚   â””â”€â”€ queue.ts             # ç¦»çº¿é˜Ÿåˆ—
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ components/              # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ErrorBoundary.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ LoadingSpinner.vue
â”‚   â”‚   â”‚   â””â”€â”€ ConfirmDialog.vue
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ composables/             # é€šç”¨ç»„åˆå‡½æ•°
â”‚   â”‚       â”œâ”€â”€ useNetworkStatus.ts
â”‚   â”‚       â”œâ”€â”€ useErrorHandler.ts
â”‚   â”‚       â””â”€â”€ useLocalization.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/              # åŸºç¡€è®¾æ–½
â”‚   â”‚   â”œâ”€â”€ state-machine/           # çŠ¶æ€æœº
â”‚   â”‚   â”‚   â”œâ”€â”€ paymentStateMachine.ts
â”‚   â”‚   â”‚   â””â”€â”€ transactionFlow.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ error-recovery/          # é”™è¯¯æ¢å¤
â”‚   â”‚   â”‚   â”œâ”€â”€ retryStrategy.ts
â”‚   â”‚   â”‚   â””â”€â”€ fallback.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ api/                     # APIè°ƒç”¨å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ interceptors.ts
â”‚   â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ i18n/                    # å›½é™…åŒ–ï¼ˆ11ç§å°åº¦è¯­è¨€ï¼‰
â”‚   â”‚       â”œâ”€â”€ en.ts
â”‚   â”‚       â”œâ”€â”€ hi.ts
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/                       # é¡µé¢è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ index.vue
â”‚   â”‚   â”œâ”€â”€ wallet.vue
â”‚   â”‚   â”œâ”€â”€ transaction/
â”‚   â”‚   â”‚   â”œâ”€â”€ payment.vue
â”‚   â”‚   â”‚   â””â”€â”€ transfer.vue
â”‚   â”‚   â”œâ”€â”€ kyc/
â”‚   â”‚   â”‚   â”œâ”€â”€ upload.vue
â”‚   â”‚   â”‚   â””â”€â”€ verify.vue
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ layouts/                     # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ default.vue
â”‚   â”‚   â””â”€â”€ auth.vue
â”‚   â”‚
â”‚   â”œâ”€â”€ app.vue
â”‚   â””â”€â”€ main.ts
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/                        # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ integration/                 # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ e2e/                         # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚
â”œâ”€â”€ scripts/                         # å·¥å…·è„šæœ¬ï¼ˆæ¥è‡ªSkillçš„scripts/ï¼‰
â”‚   â”œâ”€â”€ security-audit.py
â”‚   â”œâ”€â”€ architecture-validator.py
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ nuxt.config.ts                   # Nuxt 3é…ç½®
â”œâ”€â”€ vitest.config.ts                 # æµ‹è¯•é…ç½®
â”œâ”€â”€ tailwind.config.ts               # Tailwindé…ç½®
â”œâ”€â”€ tsconfig.json                    # TypeScripté…ç½®ï¼ˆstrict modeï¼‰
â”œâ”€â”€ .env.example                     # ç¯å¢ƒå˜é‡æ¨¡æ¿
â””â”€â”€ README.md
```

### æ¨¡å—ä¾èµ–å…³ç³»

```
auth (è®¤è¯) â”€â”€â†’ wallet (é’±åŒ…)
                 â”œâ”€â†’ transaction (äº¤æ˜“)
                 â”‚   â”œâ”€â†’ risk-control (é£é™©)
                 â”‚   â””â”€â†’ settlement (æ¸…ç®—)
                 â””â”€â†’ user profile

shared (å…±äº«) â†â”€â”€ æ‰€æœ‰æ¨¡å—ä¾èµ–
 â”œâ”€ security
 â”œâ”€ realtime
 â””â”€ offline

infrastructure â†â”€â”€ æ‰€æœ‰æ¨¡å—ä¾èµ–
 â”œâ”€ state-machine
 â”œâ”€ error-recovery
 â”œâ”€ api
 â””â”€ i18n
```

---

## ç¬¬ä¸‰ç« ï¼šæ”¯ä»˜å®‰å…¨æœ€ä½³å®è·µ

### PCI-DSSåˆè§„æ ¸å¿ƒåŸåˆ™

**åŸåˆ™1ï¼šæ•æ„Ÿæ•°æ®æ°¸è¿œä¸å­˜å‚¨åœ¨å‰ç«¯**

```typescript
// âŒ é”™è¯¯åšæ³•
const handlePayment = async (cardNumber: string, cvv: string) => {
  // æ°¸è¿œä¸è¦åœ¨å‰ç«¯ä¿å­˜è¿™äº›ä¿¡æ¯ï¼
  localStorage.setItem('cardNumber', cardNumber)
  localStorage.setItem('cvv', cvv)
}

// âœ… æ­£ç¡®åšæ³•
const handlePayment = async (cardToken: string) => {
  // åªåœ¨å‰ç«¯ä¿å­˜æ¥è‡ªåç«¯çš„æ— å®³token
  const response = await api.processPayment({ token: cardToken })
}
```

**åŸåˆ™2ï¼šæ‰€æœ‰é€šä¿¡å¿…é¡»åŠ å¯†**

```typescript
// HTTPS + TLS 1.3 (å¿…é¡»)
const apiClient = axios.create({
  baseURL: 'https://api.payment.example.com', // æ³¨æ„ï¼šhttpsä¸æ˜¯http
  timeout: 5000,
})

// è¯·æ±‚çº§åˆ«åŠ å¯†ï¼ˆå­—æ®µçº§ï¼‰
const encryptPaymentData = (data: PaymentData): string => {
  const cipher = crypto.subtle.encrypt(
    {
      name: 'AES-GCM',
      iv: generateRandomIV(),
    },
    key,
    new TextEncoder().encode(JSON.stringify(data))
  )
  return btoa(cipher) // Base64ç¼–ç 
}
```

**åŸåˆ™3ï¼šæ— æ—¥å¿—åŸåˆ™**

```typescript
// âŒ é”™è¯¯åšæ³•
console.log('æ”¯ä»˜ä¿¡æ¯:', {
  cardNumber: '4532xxxxxxxxxxxx',
  amount: 1000,
})

// âœ… æ­£ç¡®åšæ³•
console.log('æ”¯ä»˜å¤„ç†ä¸­ï¼Œé‡‘é¢:', amount)
// æ—¥å¿—ä¸­å®Œå…¨ä¸è®°å½•cardNumber

// å®‰å…¨çš„æ—¥å¿—å‡½æ•°
const safeLog = (action: string, data: any) => {
  const sanitized = sanitizeSensitiveData(data)
  console.log(`[${action}]`, sanitized)
  // å‘é€åˆ°åç«¯å®‰å…¨çš„å®¡è®¡ç³»ç»Ÿ
  auditLog.record(action, sanitized)
}
```

### å‰ç«¯å®‰å…¨é˜²æŠ¤

#### é˜²XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰

```typescript
// Vue 3 è‡ªåŠ¨è½¬ä¹‰HTML
// âœ… å®‰å…¨
<template>
  <div>{{ userInput }}</div> <!-- è‡ªåŠ¨è½¬ä¹‰ -->
</template>

// âŒ å±é™©
<template>
  <div v-html="userInput"></div> <!-- ä»…åœ¨ä¿¡ä»»çš„å†…å®¹ä¸­ä½¿ç”¨ -->
</template>

// CSPï¼ˆå†…å®¹å®‰å…¨ç­–ç•¥ï¼‰
// åœ¨HTMLå¤´éƒ¨æ·»åŠ 
<meta
  http-equiv="Content-Security-Policy"
  content="default-src 'self'; script-src 'self' 'unsafe-inline';">
```

#### é˜²CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰

```typescript
// 1. è·å–CSRFä»¤ç‰Œ
const getCsrfToken = async () => {
  const response = await fetch('/api/csrf-token')
  return response.json().token
}

// 2. åœ¨æ¯ä¸ªä¿®æ”¹è¯·æ±‚ä¸­åŒ…å«
const api = axios.create({
  headers: {
    'X-CSRF-Token': csrfToken,
  },
})

// 3. åŒæºè¯·æ±‚æ£€æŸ¥
// åœ¨è¯·æ±‚æ‹¦æˆªå™¨ä¸­éªŒè¯
api.interceptors.request.use((config) => {
  if (['post', 'put', 'delete'].includes(config.method?.toLowerCase())) {
    config.headers['X-CSRF-Token'] = getCsrfToken()
  }
  return config
})
```

#### é˜²ä¸­é—´äººæ”»å‡»

```typescript
// 1. è¯ä¹¦ç»‘å®šï¼ˆCertificate Pinningï¼‰
const createSecureClient = () => {
  return axios.create({
    baseURL: 'https://api.payment.example.com',
    httpAgent: new http.Agent({
      rejectUnauthorized: true,
    }),
    httpsAgent: new https.Agent({
      rejectUnauthorized: true,
      ca: [fs.readFileSync('path/to/certificate.pem')],
    }),
  })
}

// 2. å­èµ„æºå®Œæ•´æ€§ï¼ˆSRIï¼‰
// åœ¨HTMLä¸­åŠ è½½è„šæœ¬æ—¶
<script
  src="https://cdn.example.com/library.js"
  integrity="sha384-hash">
</script>
```

### æ•æ„Ÿæ•°æ®åŠ å¯†ç­–ç•¥

```typescript
// åŠ å¯†Keyç®¡ç†
class EncryptionManager {
  private key: CryptoKey

  async initialize() {
    // ä»åç«¯è·å–åŠ å¯†å¯†é’¥ï¼ˆæ°¸è¿œä¸åœ¨å‰ç«¯ç”Ÿæˆï¼‰
    const keyMaterial = await window.crypto.subtle.importKey(
      'raw',
      new Uint8Array(await fetch('/api/encryption-key').then(r => r.arrayBuffer())),
      { name: 'AES-GCM' },
      false,
      ['encrypt', 'decrypt']
    )
    this.key = keyMaterial
  }

  async encrypt(data: string): Promise<string> {
    const iv = window.crypto.getRandomValues(new Uint8Array(12))
    const encrypted = await window.crypto.subtle.encrypt(
      { name: 'AES-GCM', iv },
      this.key,
      new TextEncoder().encode(data)
    )
    // è¿”å› IV + å¯†æ–‡ï¼ˆIVä¸æ˜¯å¯†é’¥ï¼Œå¯ä»¥æ˜æ–‡ä¼ è¾“ï¼‰
    return btoa(String.fromCharCode(...new Uint8Array(iv)) +
               String.fromCharCode(...new Uint8Array(encrypted)))
  }

  async decrypt(encrypted: string): Promise<string> {
    const data = atob(encrypted)
    const iv = new Uint8Array(data.charCodeAt(0), /* ... */)
    const ciphertext = new Uint8Array(data.slice(12).split('').map(c => c.charCodeAt(0)))
    const decrypted = await window.crypto.subtle.decrypt(
      { name: 'AES-GCM', iv },
      this.key,
      ciphertext
    )
    return new TextDecoder().decode(decrypted)
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const encManager = new EncryptionManager()
await encManager.initialize()
const encrypted = await encManager.encrypt(sensitiveData)
const decrypted = await encManager.decrypt(encrypted)
```

---

## ç¬¬å››ç« ï¼šå…³é”®ä¸šåŠ¡æµç¨‹æ¶æ„

### æ”¯ä»˜äº¤æ˜“å®Œæ•´æµç¨‹

æ”¯ä»˜ä»å¼€å§‹åˆ°ç»“æŸçš„å®Œæ•´çŠ¶æ€æœºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ”¯ä»˜äº¤æ˜“çŠ¶æ€æœº                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  [åˆå§‹åŒ–çŠ¶æ€] â”€SUBMITâ”€â†’ [å¾…éªŒè¯]                            â”‚
â”‚       â†“                      â†“                                â”‚
â”‚   ç”¨æˆ·è¾“å…¥               éªŒè¯ä½™é¢ã€é™é¢                      â”‚
â”‚   é‡‘é¢ã€æ”¶æ¬¾äºº           æ£€æŸ¥KYCçŠ¶æ€                         â”‚
â”‚                          â†“                                    â”‚
â”‚  [å¤±è´¥]â†â”€NOâ”€[éªŒè¯é€šè¿‡?]â”€YESâ†’ [å‘é€OTP]                     â”‚
â”‚       â†“                      â†“                                â”‚
â”‚   è¿”å›é”™è¯¯                ç”¨æˆ·è¾“å…¥OTP                        â”‚
â”‚   æç¤ºé‡è¯•                â†“                                    â”‚
â”‚                    [éªŒè¯OTP] â”€NOâ†’ [é‡è¯•æç¤º]                â”‚
â”‚                          â†“                                    â”‚
â”‚                         YES                                   â”‚
â”‚                          â†“                                    â”‚
â”‚                   [æ”¯ä»˜å¤„ç†ä¸­]                               â”‚
â”‚                   â”œâ”€ å‘é€åŠ å¯†è¯·æ±‚                           â”‚
â”‚                   â”œâ”€ ç­‰å¾…åç«¯ç¡®è®¤                           â”‚
â”‚                   â”œâ”€ è¶…æ—¶å¤„ç†ï¼ˆ5åˆ†é’Ÿï¼‰                     â”‚
â”‚                   â””â”€ é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰                    â”‚
â”‚                          â†“                                    â”‚
â”‚              [äº¤æ˜“æˆåŠŸ] æˆ– [äº¤æ˜“å¤±è´¥]                        â”‚
â”‚                   â†“              â†“                            â”‚
â”‚              æ›´æ–°ä½™é¢         æ˜¾ç¤ºé”™è¯¯                        â”‚
â”‚              å‘é€é€šçŸ¥         å»ºè®®é‡è¯•/è”ç³»å®¢æœ             â”‚
â”‚              è®°å½•äº¤æ˜“         åŒæ­¥åˆ°æœåŠ¡å™¨                   â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### TypeScriptä¸­çš„çŠ¶æ€æœºå®ç°

```typescript
// å®šä¹‰æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€
type PaymentState =
  | 'idle'
  | 'validating'
  | 'otp_pending'
  | 'processing'
  | 'success'
  | 'failed'
  | 'cancelled'

// å®šä¹‰çŠ¶æ€è½¬æ¢è§„åˆ™
const paymentTransitions: Record<PaymentState, PaymentState[]> = {
  idle: ['validating', 'cancelled'],
  validating: ['otp_pending', 'failed'],
  otp_pending: ['processing', 'failed'],
  processing: ['success', 'failed'],
  success: ['idle'],
  failed: ['idle', 'validating'],
  cancelled: ['idle'],
}

// çŠ¶æ€æœºç±»
class PaymentStateMachine {
  private currentState: PaymentState = 'idle'
  private readonly transitions = paymentTransitions

  canTransition(toState: PaymentState): boolean {
    return this.transitions[this.currentState]?.includes(toState) ?? false
  }

  transition(toState: PaymentState): boolean {
    if (!this.canTransition(toState)) {
      throw new Error(
        `Cannot transition from ${this.currentState} to ${toState}`
      )
    }
    this.currentState = toState
    return true
  }

  getState(): PaymentState {
    return this.currentState
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const paymentSM = new PaymentStateMachine()
paymentSM.transition('validating') // âœ… å…è®¸
paymentSM.transition('processing') // âŒ é”™è¯¯ï¼šä¸èƒ½ä»validatingç›´æ¥åˆ°processing
```

### KYCï¼ˆäº†è§£ä½ çš„å®¢æˆ·ï¼‰èº«ä»½éªŒè¯æµç¨‹

KYCæ˜¯æ”¯ä»˜å¹³å°çš„æ ¸å¿ƒï¼Œéœ€è¦å¤šæ­¥éªŒè¯ï¼š

```
[ç”¨æˆ·æ³¨å†Œ]
    â†“
[è¾“å…¥åŸºæœ¬ä¿¡æ¯] (å§“åã€ç”µè¯ã€é‚®ç®±)
    â†“
[OTPéªŒè¯ç”µè¯å·ç ]
    â†“
[è¾“å…¥åœ°å€ä¿¡æ¯]
    â†“
[ä¸Šä¼ èº«ä»½è¯ä»¶]
    â”‚â”œâ”€ Aadhaar (å°åº¦å”¯ä¸€èº«ä»½å·)
    â”‚â”œâ”€ é©¾ç…§
    â”‚â””â”€ æŠ¤ç…§
    â†“
[ç…§ç‰‡ä¸Šä¼  + æ´»ä½“æ£€æµ‹]
    â”œâ”€ å‰è„¸ç…§ç‰‡
    â”œâ”€ æ´»ä½“æ£€æµ‹ï¼ˆçœ¨çœ¼ã€è½¬å¤´ï¼‰
    â””â”€ ä¸èº«ä»½è¯å¯¹æ¯”
    â†“
[ç­‰å¾…å®¡æ ¸] (ç”±äººå·¥æˆ–AIå®¡æ ¸)
    â”œâ”€ âœ… å·²æ‰¹å‡† â†’ KYCå®Œæˆ
    â”œâ”€ âŒ è¢«æ‹’ç» â†’ æ˜¾ç¤ºåŸå› ï¼Œå¯é‡æ–°ç”³è¯·
    â””â”€ â³ å®¡æ ¸ä¸­ â†’ æ˜¾ç¤ºè¿›åº¦
    â†“
[ç”¨æˆ·è·å¾—ä¸åŒçº§åˆ«çš„æ”¯ä»˜é™é¢]
    â”œâ”€ Tier 1 (KYC Lite): â‚¹100,000/å¤©
    â”œâ”€ Tier 2 (å®Œæ•´KYC): â‚¹500,000/å¤©
    â””â”€ Tier 3 (å¢å¼ºKYC): æ— é™åˆ¶
```

#### Vueç»„ä»¶å®ç°ï¼š

```typescript
// composables/useKYCFlow.ts
import { ref, computed } from 'vue'

type KYCStep =
  | 'basic_info'
  | 'phone_verify'
  | 'address'
  | 'document_upload'
  | 'liveness_check'
  | 'pending_review'
  | 'completed'

export const useKYCFlow = () => {
  const currentStep = ref<KYCStep>('basic_info')
  const kycData = ref({
    basicInfo: {},
    address: {},
    document: null,
    livenessCheck: {},
  })

  const canProceedToNextStep = computed(() => {
    switch (currentStep.value) {
      case 'basic_info':
        return kycData.value.basicInfo.name &&
               kycData.value.basicInfo.phone
      case 'phone_verify':
        return !!kycData.value.basicInfo.otpVerified
      case 'address':
        return !!kycData.value.address.fullAddress
      case 'document_upload':
        return !!kycData.value.document
      case 'liveness_check':
        return !!kycData.value.livenessCheck.passed
      default:
        return false
    }
  })

  const nextStep = () => {
    const steps: KYCStep[] = [
      'basic_info', 'phone_verify', 'address',
      'document_upload', 'liveness_check', 'pending_review'
    ]
    const currentIndex = steps.indexOf(currentStep.value)
    if (currentIndex < steps.length - 1) {
      currentStep.value = steps[currentIndex + 1]
    }
  }

  const submitKYC = async () => {
    try {
      const response = await api.submitKYC(kycData.value)
      currentStep.value = 'pending_review'
      return response
    } catch (error) {
      console.error('KYCæäº¤å¤±è´¥:', error)
      throw error
    }
  }

  return {
    currentStep,
    kycData,
    canProceedToNextStep,
    nextStep,
    submitKYC,
  }
}

// ç»„ä»¶ä½¿ç”¨
<template>
  <div class="kyc-flow">
    <div v-if="currentStep === 'basic_info'">
      <BasicInfoForm @submit="nextStep" />
    </div>
    <div v-else-if="currentStep === 'phone_verify'">
      <PhoneVerifyForm @submit="nextStep" />
    </div>
    <!-- ... å…¶ä»–æ­¥éª¤ -->
    <div v-else-if="currentStep === 'pending_review'">
      <PendingMessage />
    </div>
  </div>
</template>
```

---

## ç¬¬äº”ç« ï¼šé«˜å¹¶å‘ä¸å®æ—¶æ€§è®¾è®¡

### WebSocketå®æ—¶çŠ¶æ€æ›´æ–°æ¶æ„

æ”¯ä»˜å¹³å°éœ€è¦å®æ—¶æ¨é€ï¼šä½™é¢ã€äº¤æ˜“çŠ¶æ€ã€é£é™©æç¤ºç­‰ã€‚

```typescript
// composables/useRealtimeUpdates.ts
import { ref, onMounted, onUnmounted } from 'vue'

interface RealtimeUpdate {
  type: 'balance' | 'transaction' | 'alert' | 'kyc_status'
  data: any
  timestamp: number
}

export const useRealtimeUpdates = () => {
  const ws = ref<WebSocket | null>(null)
  const balance = ref(0)
  const transactionStatus = ref<Record<string, any>>({})
  const alerts = ref<RealtimeUpdate[]>([])
  const isConnected = ref(false)
  const reconnectAttempts = ref(0)
  const maxReconnectAttempts = 5

  const connect = () => {
    try {
      // ä½¿ç”¨ wss:// (WebSocket Secure)
      ws.value = new WebSocket(
        'wss://api.payment.example.com/realtime',
        ['payment-v1'] // å­åè®®ç”¨äºç‰ˆæœ¬æ§åˆ¶
      )

      ws.value.onopen = () => {
        console.log('å®æ—¶è¿æ¥å·²å»ºç«‹')
        isConnected.value = true
        reconnectAttempts.value = 0

        // è®¤è¯
        ws.value?.send(JSON.stringify({
          type: 'auth',
          token: getAuthToken(),
        }))

        // è®¢é˜…æ„Ÿå…´è¶£çš„äº‹ä»¶
        ws.value?.send(JSON.stringify({
          type: 'subscribe',
          channels: ['balance', 'transactions', 'alerts'],
        }))
      }

      ws.value.onmessage = (event) => {
        const update: RealtimeUpdate = JSON.parse(event.data)
        handleUpdate(update)
      }

      ws.value.onerror = (error) => {
        console.error('WebSocketé”™è¯¯:', error)
        isConnected.value = false
      }

      ws.value.onclose = () => {
        console.log('è¿æ¥å…³é—­ï¼Œå°è¯•é‡è¿...')
        isConnected.value = false
        attemptReconnect()
      }
    } catch (error) {
      console.error('WebSocketè¿æ¥å¤±è´¥:', error)
      attemptReconnect()
    }
  }

  const handleUpdate = (update: RealtimeUpdate) => {
    switch (update.type) {
      case 'balance':
        // ä¹è§‚æ›´æ–°éªŒè¯ï¼šä»…åœ¨ç­¾åæœ‰æ•ˆæ—¶æ›´æ–°
        if (verifySignature(update)) {
          balance.value = update.data.balance
        }
        break
      case 'transaction':
        transactionStatus.value[update.data.txId] = update.data
        break
      case 'alert':
        alerts.value.push(update)
        // è‡ªåŠ¨ç§»é™¤æ—§è­¦å‘Šï¼ˆ5åˆ†é’Ÿåï¼‰
        setTimeout(() => {
          alerts.value = alerts.value.filter(a => a.timestamp !== update.timestamp)
        }, 5 * 60 * 1000)
        break
      case 'kyc_status':
        // KYCçŠ¶æ€æ›´æ–°ï¼Œé€šçŸ¥ç”¨æˆ·
        emitEvent('kyc-updated', update.data)
        break
    }
  }

  const attemptReconnect = () => {
    if (reconnectAttempts.value < maxReconnectAttempts) {
      reconnectAttempts.value++
      // æŒ‡æ•°é€€é¿ï¼š1s, 2s, 4s, 8s, 16s
      const delay = Math.pow(2, reconnectAttempts.value - 1) * 1000
      console.log(`${delay}msåé‡æ–°è¿æ¥...`)
      setTimeout(connect, delay)
    } else {
      console.error('æ— æ³•é‡æ–°è¿æ¥ï¼Œè¯·åˆ·æ–°é¡µé¢')
      // é€šçŸ¥ç”¨æˆ·æ‰‹åŠ¨åˆ·æ–°
      emitEvent('connection-failed')
    }
  }

  const disconnect = () => {
    if (ws.value) {
      ws.value.close()
      ws.value = null
    }
  }

  onMounted(() => {
    connect()
  })

  onUnmounted(() => {
    disconnect()
  })

  return {
    balance,
    transactionStatus,
    alerts,
    isConnected,
    disconnect,
  }
}
```

### ä¹è§‚æ›´æ–° vs å¼ºä¸€è‡´æ€§

æ”¯ä»˜ç³»ç»Ÿä¸­çš„æƒè¡¡ï¼š

```typescript
// ä½¿ç”¨åœºæ™¯ï¼šè½¬è´¦é‡‘é¢è¾“å…¥
const optimisticUpdateBalance = async (amount: number) => {
  // 1. ç«‹å³åœ¨å‰ç«¯æ›´æ–°ï¼ˆä¹è§‚ï¼‰
  const previousBalance = balance.value
  balance.value -= amount

  try {
    // 2. å‘é€è¯·æ±‚åˆ°åç«¯
    const response = await api.transfer({
      amount,
      toUserId: recipientId.value
    })

    // 3. åç«¯ç¡®è®¤ï¼ŒåŒæ­¥çœŸå®ä½™é¢
    balance.value = response.newBalance

    return response
  } catch (error) {
    // 4. å¦‚æœå¤±è´¥ï¼Œå›æ»šåˆ°ä¹‹å‰çš„çŠ¶æ€
    balance.value = previousBalance
    throw error
  }
}

// ä½¿ç”¨åœºæ™¯ï¼šæ”¯ä»˜çŠ¶æ€æŸ¥è¯¢
const getTransactionStatusRealtime = async (txId: string) => {
  // ä¸ä½¿ç”¨ä¹è§‚æ›´æ–°ï¼Œç›´æ¥è·å–æœ€æ–°çŠ¶æ€
  const status = await api.getTransactionStatus(txId)
  transactionStatus.value = status
  return status
}
```

### é˜²æ­¢é‡å¤æ”¯ä»˜ï¼ˆå¹‚ç­‰æ€§ï¼‰

```typescript
// ä½¿ç”¨Idempotency Keyé˜²æ­¢é‡å¤æ‰£æ¬¾
const submitPayment = async (paymentData: PaymentData) => {
  // 1. ç”Ÿæˆå”¯ä¸€çš„è¯·æ±‚IDï¼ˆåœ¨å®¢æˆ·ç«¯ç”Ÿæˆï¼‰
  const idempotencyKey = generateIdempotencyKey(paymentData)

  // 2. åœ¨æ‰€æœ‰æ”¯ä»˜è¯·æ±‚ä¸­åŒ…å«æ­¤Key
  const config = {
    headers: {
      'Idempotency-Key': idempotencyKey,
    },
  }

  try {
    // 3. ç¬¬ä¸€æ¬¡è¯·æ±‚æ‰§è¡Œæ”¯ä»˜
    const response = await api.payment(paymentData, config)
    return response
  } catch (error) {
    // 4. å¦‚æœç½‘ç»œé”™è¯¯ï¼Œé‡è¯•ä½¿ç”¨ç›¸åŒçš„Key
    // åç«¯ä¼šè¯†åˆ«é‡å¤è¯·æ±‚ï¼Œè¿”å›ç¼“å­˜çš„ç»“æœ
    const retryResponse = await api.payment(paymentData, config)
    return retryResponse
  }
}

// ç”ŸæˆIdempotency Keyçš„æ–¹æ³•
const generateIdempotencyKey = (data: PaymentData): string => {
  const key = `${userId}-${data.recipientId}-${data.amount}-${Date.now()}`
  return crypto.createHash('sha256').update(key).digest('hex')
}
```

---

## ç¬¬å…­ç« ï¼šç¦»çº¿ä¼˜å…ˆæ¶æ„ï¼ˆOffline-Firstï¼‰

å°åº¦ç½‘ç»œç¯å¢ƒçš„ç‰¹æ®Šè€ƒè™‘ï¼š
- 3G/4Gä¿¡å·ä¸ç¨³å®š
- ç”¨æˆ·å¯èƒ½è¿›å…¥éš§é“/åœ°ä¸‹å®¤
- é«˜å³°æœŸç½‘ç»œæ‹¥å¡

### ç¦»çº¿æ•°æ®åŒæ­¥ç­–ç•¥

```typescript
// composables/useOfflineSync.ts
import { ref } from 'vue'

interface OfflineAction {
  id: string
  type: 'payment' | 'transfer' | 'recharge'
  data: any
  timestamp: number
  status: 'pending' | 'synced' | 'failed'
}

export const useOfflineSync = () => {
  const offlineQueue = ref<OfflineAction[]>([])
  const isOnline = ref(navigator.onLine)
  const syncInProgress = ref(false)

  // ç›‘å¬ç½‘ç»œçŠ¶æ€
  window.addEventListener('online', () => {
    isOnline.value = true
    syncOfflineActions()
  })
  window.addEventListener('offline', () => {
    isOnline.value = false
  })

  // å½“åœ¨çº¿æ—¶æ·»åŠ åˆ°é˜Ÿåˆ—
  const queueAction = async (
    type: OfflineAction['type'],
    data: any
  ): Promise<boolean> => {
    const action: OfflineAction = {
      id: generateId(),
      type,
      data,
      timestamp: Date.now(),
      status: 'pending',
    }

    if (isOnline.value) {
      // ç›´æ¥æ‰§è¡Œ
      try {
        await executeAction(action)
        action.status = 'synced'
        return true
      } catch (error) {
        // å³ä½¿åœ¨çº¿ä¹Ÿå¤±è´¥ï¼ŒåŠ å…¥é˜Ÿåˆ—é‡è¯•
        offlineQueue.value.push(action)
        return false
      }
    } else {
      // ç¦»çº¿çŠ¶æ€ï¼ŒåŠ å…¥æœ¬åœ°é˜Ÿåˆ—
      offlineQueue.value.push(action)
      saveQueueToStorage()
      return true
    }
  }

  // åŒæ­¥æ‰€æœ‰ç¦»çº¿åŠ¨ä½œ
  const syncOfflineActions = async () => {
    if (syncInProgress.value) return

    syncInProgress.value = true
    const pendingActions = offlineQueue.value.filter(
      a => a.status === 'pending'
    )

    for (const action of pendingActions) {
      try {
        await executeAction(action)
        action.status = 'synced'
      } catch (error) {
        console.error(`åŒæ­¥å¤±è´¥: ${action.id}`, error)
        action.status = 'failed'
      }
    }

    // æ¸…ç†å·²åŒæ­¥çš„action
    offlineQueue.value = offlineQueue.value.filter(
      a => a.status !== 'synced'
    )
    saveQueueToStorage()
    syncInProgress.value = false
  }

  const executeAction = async (action: OfflineAction) => {
    switch (action.type) {
      case 'payment':
        return await api.payment(action.data)
      case 'transfer':
        return await api.transfer(action.data)
      case 'recharge':
        return await api.recharge(action.data)
    }
  }

  // IndexedDBæŒä¹…åŒ–
  const saveQueueToStorage = () => {
    const db = openIndexedDB()
    const tx = db.transaction('offlineActions', 'readwrite')
    tx.objectStore('offlineActions').clear()
    offlineQueue.value.forEach(action => {
      tx.objectStore('offlineActions').add(action)
    })
  }

  const loadQueueFromStorage = () => {
    const db = openIndexedDB()
    const tx = db.transaction('offlineActions', 'readonly')
    const store = tx.objectStore('offlineActions')
    const request = store.getAll()
    request.onsuccess = () => {
      offlineQueue.value = request.result
    }
  }

  return {
    offlineQueue,
    isOnline,
    syncInProgress,
    queueAction,
    syncOfflineActions,
    loadQueueFromStorage,
  }
}
```

### æœ¬åœ°ç¼“å­˜ç­–ç•¥

```typescript
// ä½¿ç”¨Service Workerç¼“å­˜
// public/service-worker.js

const CACHE_VERSION = 'v1'
const CACHE_NAME = `payment-app-${CACHE_VERSION}`

const CACHE_URLS = [
  '/',
  '/index.html',
  '/app.js',
  '/app.css',
  '/logo.png',
]

self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(CACHE_NAME).then((cache) => {
      return cache.addAll(CACHE_URLS)
    })
  )
})

self.addEventListener('fetch', (event) => {
  const { request } = event
  const url = new URL(request.url)

  // APIè¯·æ±‚ï¼šç½‘ç»œä¼˜å…ˆï¼Œç¼“å­˜å¤‡ç”¨
  if (url.pathname.startsWith('/api')) {
    event.respondWith(
      fetch(request)
        .then(response => {
          // ç¼“å­˜æˆåŠŸçš„å“åº”
          if (response.status === 200) {
            const responseToCache = response.clone()
            caches.open(CACHE_NAME).then(cache => {
              cache.put(request, responseToCache)
            })
          }
          return response
        })
        .catch(() => {
          // ç½‘ç»œå¤±è´¥ï¼Œå°è¯•ç¼“å­˜
          return caches.match(request)
        })
    )
  } else {
    // é™æ€èµ„æºï¼šç¼“å­˜ä¼˜å…ˆ
    event.respondWith(
      caches.match(request).then(response => {
        return response || fetch(request)
      })
    )
  }
})
```

---

## ç¬¬ä¸ƒç« ï¼šå¤šå›½å¸‚åœºæ”¯æŒï¼ˆå›½é™…åŒ–ï¼‰

### å°åº¦è¯­è¨€æ”¯æŒ

å°åº¦æœ‰11ç§å®˜æ–¹è¯­è¨€ï¼Œæ”¯ä»˜å¹³å°å¿…é¡»æ”¯æŒä¸»è¦çš„ï¼š

```
- è‹±è¯­ (en) - å¸¸ç”¨äºæŠ€æœ¯å’Œå®˜æ–¹æ–‡ä»¶
- å°åœ°è¯­ (hi) - æœ€å¹¿æ³›ä½¿ç”¨ï¼Œ~43%äººå£
- é©¬æ‹‰åœ°è¯­ (mr) - è¥¿éƒ¨ï¼ˆé©¬å“ˆæ‹‰æ–½ç‰¹æ‹‰é‚¦ï¼‰
- æ³°ç±³å°”è¯­ (ta) - å—éƒ¨
- æ³°å¢å›ºè¯­ (te) - å—éƒ¨
- å¤å‰æ‹‰ç‰¹è¯­ (gu) - è¥¿éƒ¨
- å¡çº³è¾¾è¯­ (kn) - å—éƒ¨
- æ—é®æ™®è¯­ (pa) - åŒ—éƒ¨
- å­ŸåŠ æ‹‰è¯­ (bn) - ä¸œéƒ¨
- ä¹Œå°”éƒ½è¯­ (ur) - å°‘æ•°æ°‘æ—
- å¥¥é‡Œäºšè¯­ (or) - ä¸œéƒ¨
```

### ä½¿ç”¨ vue-i18n é…ç½®

```typescript
// src/infrastructure/i18n/index.ts
import { createI18n } from 'vue-i18n'
import en from './locales/en.json'
import hi from './locales/hi.json'
import mr from './locales/mr.json'
// ... å…¶ä»–è¯­è¨€

const messages = {
  en,
  hi,
  mr,
  // ...
}

// æ£€æµ‹ç”¨æˆ·çš„é¦–é€‰è¯­è¨€
const detectLanguage = (): string => {
  // 1. æ£€æŸ¥æœ¬åœ°å­˜å‚¨
  const saved = localStorage.getItem('preferredLanguage')
  if (saved) return saved

  // 2. æ£€æŸ¥æµè§ˆå™¨è¯­è¨€
  const browserLang = navigator.language.split('-')[0]
  if (Object.keys(messages).includes(browserLang)) return browserLang

  // 3. é»˜è®¤è‹±è¯­
  return 'en'
}

export const i18n = createI18n({
  legacy: false,
  locale: detectLanguage(),
  fallbackLocale: 'en',
  messages,
  globalInjection: true,
  compositionOnly: true,
})

// è¯­è¨€åˆ‡æ¢å‡½æ•°
export const setLanguage = (lang: string) => {
  i18n.global.locale.value = lang
  localStorage.setItem('preferredLanguage', lang)
  // æ›´æ–°HTML langå±æ€§
  document.documentElement.lang = lang
}
```

### å¤šè´§å¸æ”¯æŒ

```typescript
// src/infrastructure/i18n/currency.ts
import { ref } from 'vue'

type Currency = 'INR' | 'USD' | 'EUR' | 'GBP'

const exchangeRates = ref({
  'INR': 1,
  'USD': 0.012,
  'EUR': 0.011,
  'GBP': 0.0095,
})

const formatCurrency = (amount: number, currency: Currency = 'INR'): string => {
  const formatter = new Intl.NumberFormat(
    getLocaleForCurrency(currency),
    {
      style: 'currency',
      currency,
      minimumFractionDigits: 2,
    }
  )
  return formatter.format(amount)
}

const getLocaleForCurrency = (currency: Currency): string => {
  const localeMap: Record<Currency, string> = {
    'INR': 'en-IN',
    'USD': 'en-US',
    'EUR': 'en-DE',
    'GBP': 'en-GB',
  }
  return localeMap[currency]
}

// ä½¿ç”¨
const displayAmount = formatCurrency(1000, 'INR') // â‚¹1,000.00
```

---

## ç¬¬å…«ç« ï¼šæ€§èƒ½ä¼˜åŒ–ä¸ä½ç«¯è®¾å¤‡æ”¯æŒ

### Lighthouseæ€§èƒ½ç›®æ ‡

```
æ”¯ä»˜å¹³å°çš„Lighthouseè¯„åˆ†ç›®æ ‡ï¼š
  æ€§èƒ½ (Performance): > 90
  å¯è®¿é—®æ€§ (Accessibility): > 90
  æœ€ä½³å®è·µ (Best Practices): > 85
  SEO: > 90

æ ¸å¿ƒWebæŒ‡æ ‡ (Core Web Vitals):
  LCP (æœ€å¤§å†…å®¹ç»˜åˆ¶): < 2.5s
  FID (é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ): < 100ms
  CLS (ç´¯ç§¯å¸ƒå±€åç§»): < 0.1
```

### ä½ç«¯è®¾å¤‡ä¼˜åŒ–ï¼ˆå°åº¦ç”¨æˆ·å¤šä½¿ç”¨4G+ä½å†…å­˜è®¾å¤‡ï¼‰

```typescript
// 1. ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
import { defineAsyncComponent } from 'vue'

const PaymentForm = defineAsyncComponent(
  () => import('@/features/transaction/components/PaymentForm.vue')
)
const KYCUpload = defineAsyncComponent(
  () => import('@/features/auth/components/KYCUpload.vue')
)

// 2. è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤„ç†é•¿äº¤æ˜“åˆ—è¡¨ï¼‰
import { VirtualScroller } from 'vue-virtual-scroller'

<template>
  <VirtualScroller
    :items="transactions"
    :item-size="100"
    key-field="id"
  >
    <template #default="{ item }">
      <TransactionItem :transaction="item" />
    </template>
  </VirtualScroller>
</template>

// 3. å›¾ç‰‡ä¼˜åŒ–
<template>
  <!-- ä½¿ç”¨ç°ä»£æ ¼å¼ (WebP) + é™çº§ -->
  <picture>
    <source srcset="/logo.webp" type="image/webp">
    <img src="/logo.png" alt="æ”¯ä»˜å¹³å°">
  </picture>

  <!-- å“åº”å¼å›¾ç‰‡ -->
  <img
    srcset="
      /wallet-small.png 400w,
      /wallet-medium.png 800w,
      /wallet-large.png 1200w
    "
    sizes="(max-width: 600px) 400px, 800px"
    src="/wallet-medium.png"
    alt="é’±åŒ…">
</template>

// 4. å‹ç¼©å’ŒTree Shaking
// vite.config.ts
export default {
  build: {
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true,
      },
    },
    rollupOptions: {
      output: {
        manualChunks: {
          'vue': ['vue'],
          'crypto': ['crypto-js'],
        },
      },
    },
  },
}
```

### ç½‘ç»œä¼˜åŒ–ï¼ˆ4Gç¯å¢ƒï¼‰

```typescript
// é’ˆå¯¹å¼±ç½‘ç¯å¢ƒçš„ä¼˜åŒ–
const apiClient = axios.create({
  baseURL: 'https://api.payment.example.com',
  timeout: 10000, // è¾ƒé•¿çš„è¶…æ—¶æ—¶é—´
})

// è¯·æ±‚å‹ç¼©
import compression from 'compression-webpack-plugin'

apiClient.interceptors.request.use((config) => {
  // å¯¹å¤§è¯·æ±‚ä½“è¿›è¡Œå‹ç¼©
  if (config.data && JSON.stringify(config.data).length > 1000) {
    config.headers['Content-Encoding'] = 'gzip'
  }
  return config
})

// å“åº”ç¼“å­˜ç­–ç•¥
const cache = new Map<string, { data: any; timestamp: number }>()

apiClient.interceptors.response.use((response) => {
  // ç¼“å­˜GETè¯·æ±‚çš„å“åº”ï¼ˆ5åˆ†é’Ÿæœ‰æ•ˆæœŸï¼‰
  if (response.config.method === 'get') {
    const cacheKey = response.config.url
    cache.set(cacheKey, {
      data: response.data,
      timestamp: Date.now(),
    })
  }
  return response
})

// ä½¿ç”¨ç¼“å­˜
const getCachedData = (url: string) => {
  const cached = cache.get(url)
  if (cached && Date.now() - cached.timestamp < 5 * 60 * 1000) {
    return cached.data
  }
  return null
}
```

---

## ç¬¬ä¹ç« ï¼šå®Œæ•´æ¡ˆä¾‹ - è½¬è´¦åŠŸèƒ½å®ç°

ä»éœ€æ±‚åˆ°ä»£ç çš„å®Œæ•´ç¤ºä¾‹ï¼Œå±•ç¤ºå‰é¢æ‰€æœ‰æ¦‚å¿µçš„å®é™…åº”ç”¨ã€‚

**åŠŸèƒ½éœ€æ±‚**ï¼š
1. ç”¨æˆ·è¾“å…¥æ”¶æ¬¾äººè´¦å·å’Œé‡‘é¢
2. éªŒè¯KYCç­‰çº§é™é¢
3. å‘é€OTPéªŒè¯
4. ç¡®è®¤è½¬è´¦
5. å¤„ç†è½¬è´¦
6. æ˜¾ç¤ºç»“æœ

### çŠ¶æ€ç®¡ç† (Pinia Store)

```typescript
// src/features/transaction/stores/transferStore.ts
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'

export interface TransferState {
  recipientId: string
  amount: number
  description: string
  status: 'idle' | 'validating' | 'otp_sent' | 'processing' | 'success' | 'failed'
  error: string | null
  otpSent: boolean
  transactionId: string | null
}

export const useTransferStore = defineStore('transfer', () => {
  const state = ref<TransferState>({
    recipientId: '',
    amount: 0,
    description: '',
    status: 'idle',
    error: null,
    otpSent: false,
    transactionId: null,
  })

  const canTransfer = computed(() => {
    return (
      state.value.recipientId &&
      state.value.amount > 0 &&
      state.value.status === 'idle'
    )
  })

  const resetForm = () => {
    state.value = {
      recipientId: '',
      amount: 0,
      description: '',
      status: 'idle',
      error: null,
      otpSent: false,
      transactionId: null,
    }
  }

  return {
    state,
    canTransfer,
    resetForm,
  }
})
```

### ç»„åˆå‡½æ•° (Business Logic)

```typescript
// src/features/transaction/composables/useTransfer.ts
import { ref } from 'vue'
import { useTransferStore } from '../stores/transferStore'
import { useWalletStore } from '../../wallet/stores/walletStore'
import { useAuthStore } from '../../auth/stores/authStore'

export const useTransfer = () => {
  const transferStore = useTransferStore()
  const walletStore = useWalletStore()
  const authStore = useAuthStore()
  const otp = ref('')

  // éªŒè¯è½¬è´¦å¯è¡Œæ€§
  const validateTransfer = async (): Promise<boolean> => {
    const { recipientId, amount } = transferStore.state

    // 1. æ£€æŸ¥ä½™é¢
    if (amount > walletStore.state.balance) {
      transferStore.state.error = 'ä½™é¢ä¸è¶³'
      return false
    }

    // 2. æ£€æŸ¥KYCç­‰çº§é™é¢
    const kycTier = authStore.state.kycTier
    const limits: Record<string, number> = {
      'tier1': 100000,
      'tier2': 500000,
      'tier3': Infinity,
    }

    if (amount > limits[kycTier]) {
      transferStore.state.error = `æ‚¨çš„KYCç­‰çº§é™åˆ¶å•ç¬”è½¬è´¦${limits[kycTier]}`
      return false
    }

    // 3. éªŒè¯æ”¶æ¬¾äºº
    try {
      const recipientValid = await api.validateRecipient({
        recipientId,
      })
      if (!recipientValid) {
        transferStore.state.error = 'æ”¶æ¬¾äººè´¦æˆ·ä¸å­˜åœ¨'
        return false
      }
    } catch (error) {
      transferStore.state.error = 'éªŒè¯æ”¶æ¬¾äººå¤±è´¥ï¼Œè¯·é‡è¯•'
      return false
    }

    return true
  }

  // è¯·æ±‚OTP
  const sendOTP = async (): Promise<boolean> => {
    transferStore.state.status = 'validating'

    try {
      if (!(await validateTransfer())) {
        transferStore.state.status = 'idle'
        return false
      }

      // å‘é€OTP
      await api.sendOTP({
        transactionType: 'transfer',
        amount: transferStore.state.amount,
      })

      transferStore.state.status = 'otp_sent'
      transferStore.state.otpSent = true
      transferStore.state.error = null
      return true
    } catch (error) {
      transferStore.state.error = 'å‘é€OTPå¤±è´¥'
      transferStore.state.status = 'idle'
      return false
    }
  }

  // éªŒè¯OTPå¹¶å¤„ç†è½¬è´¦
  const confirmTransfer = async (): Promise<boolean> => {
    if (!otp.value || otp.value.length !== 6) {
      transferStore.state.error = 'OTPæ ¼å¼ä¸æ­£ç¡®'
      return false
    }

    transferStore.state.status = 'processing'

    try {
      // ç”Ÿæˆå¹‚ç­‰æ€§Keyï¼Œé˜²æ­¢é‡å¤
      const idempotencyKey = generateIdempotencyKey({
        recipientId: transferStore.state.recipientId,
        amount: transferStore.state.amount,
      })

      // æ‰§è¡Œè½¬è´¦
      const response = await api.transfer(
        {
          recipientId: transferStore.state.recipientId,
          amount: transferStore.state.amount,
          description: transferStore.state.description,
          otp: otp.value,
        },
        {
          headers: {
            'Idempotency-Key': idempotencyKey,
          },
        }
      )

      // ä¹è§‚æ›´æ–°ä½™é¢
      walletStore.state.balance -= transferStore.state.amount

      transferStore.state.status = 'success'
      transferStore.state.transactionId = response.transactionId
      transferStore.state.error = null

      return true
    } catch (error) {
      if (error.code === 'INVALID_OTP') {
        transferStore.state.error = 'OTPæ— æ•ˆæˆ–å·²è¿‡æœŸ'
      } else if (error.code === 'INSUFFICIENT_BALANCE') {
        transferStore.state.error = 'ä½™é¢ä¸è¶³'
      } else {
        transferStore.state.error = 'è½¬è´¦å¤±è´¥ï¼Œè¯·é‡è¯•'
      }

      transferStore.state.status = 'failed'
      return false
    }
  }

  return {
    otp,
    sendOTP,
    confirmTransfer,
    validateTransfer,
  }
}
```

### Vueç»„ä»¶

```vue
<!-- src/features/transaction/pages/Transfer.vue -->
<template>
  <div class="transfer-page">
    <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
    <StepIndicator
      :current-step="currentStep"
      :steps="['è¾“å…¥ä¿¡æ¯', 'éªŒè¯OTP', 'ç¡®è®¤è½¬è´¦', 'ç»“æœ']"
    />

    <!-- é”™è¯¯æç¤º -->
    <div v-if="transferStore.state.error" class="error-message">
      âš ï¸ {{ transferStore.state.error }}
    </div>

    <!-- æ­¥éª¤1: è¾“å…¥æ”¶æ¬¾äººå’Œé‡‘é¢ -->
    <form v-if="currentStep === 1" @submit.prevent="handleNext">
      <div class="form-group">
        <label for="recipient">æ”¶æ¬¾äººè´¦æˆ·</label>
        <input
          id="recipient"
          v-model="transferStore.state.recipientId"
          type="text"
          placeholder="è¾“å…¥æ”¶æ¬¾äººè´¦æˆ·æˆ–æ‰‹æœºå·"
          required
        />
      </div>

      <div class="form-group">
        <label for="amount">è½¬è´¦é‡‘é¢ (â‚¹)</label>
        <input
          id="amount"
          v-model.number="transferStore.state.amount"
          type="number"
          placeholder="0"
          min="0"
          required
        />
        <small>å¯ç”¨ä½™é¢: â‚¹{{ walletStore.state.balance }}</small>
      </div>

      <div class="form-group">
        <label for="description">è½¬è´¦è¯´æ˜ (å¯é€‰)</label>
        <textarea
          id="description"
          v-model="transferStore.state.description"
          placeholder="æ·»åŠ å¤‡æ³¨ä¿¡æ¯"
        />
      </div>

      <button
        type="submit"
        :disabled="!transferStore.canTransfer"
        class="btn-primary"
      >
        ä¸‹ä¸€æ­¥
      </button>
    </form>

    <!-- æ­¥éª¤2: OTPéªŒè¯ -->
    <form v-if="currentStep === 2" @submit.prevent="handleVerifyOTP">
      <div class="otp-section">
        <p>æˆ‘ä»¬å·²å‘æ‚¨çš„æ³¨å†Œæ‰‹æœºå·å‘é€äº†éªŒè¯ç </p>
        <div class="form-group">
          <label for="otp">éªŒè¯ç </label>
          <input
            id="otp"
            v-model="otp"
            type="text"
            placeholder="è¾“å…¥6ä½éªŒè¯ç "
            maxlength="6"
            pattern="[0-9]{6}"
            required
          />
        </div>

        <button type="submit" class="btn-primary">
          {{ transferStore.state.status === 'processing' ? 'å¤„ç†ä¸­...' : 'éªŒè¯' }}
        </button>

        <button type="button" @click="handleResendOTP" class="btn-secondary">
          é‡æ–°å‘é€ ({{ resendCountdown }}s)
        </button>
      </div>
    </form>

    <!-- æ­¥éª¤3: ç¡®è®¤è½¬è´¦ -->
    <div v-if="currentStep === 3" class="confirm-section">
      <div class="summary">
        <p><strong>æ”¶æ¬¾äºº:</strong> {{ transferStore.state.recipientId }}</p>
        <p><strong>é‡‘é¢:</strong> â‚¹{{ transferStore.state.amount }}</p>
        <p v-if="transferStore.state.description">
          <strong>è¯´æ˜:</strong> {{ transferStore.state.description }}
        </p>
      </div>

      <button @click="handleConfirm" class="btn-primary">
        ç¡®è®¤è½¬è´¦
      </button>
      <button @click="handleCancel" class="btn-secondary">
        å–æ¶ˆ
      </button>
    </div>

    <!-- æ­¥éª¤4: ç»“æœ -->
    <div v-if="currentStep === 4" class="result-section">
      <div v-if="transferStore.state.status === 'success'" class="success">
        <div class="icon">âœ…</div>
        <h2>è½¬è´¦æˆåŠŸ</h2>
        <p>äº¤æ˜“ID: {{ transferStore.state.transactionId }}</p>
        <button @click="handleNewTransfer" class="btn-primary">
          è¿›è¡Œæ–°çš„è½¬è´¦
        </button>
      </div>

      <div v-else class="failure">
        <div class="icon">âŒ</div>
        <h2>è½¬è´¦å¤±è´¥</h2>
        <p>{{ transferStore.state.error }}</p>
        <button @click="handleRetry" class="btn-primary">
          é‡è¯•
        </button>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import { useTransferStore } from '../stores/transferStore'
import { useWalletStore } from '../../wallet/stores/walletStore'
import { useTransfer } from '../composables/useTransfer'

const transferStore = useTransferStore()
const walletStore = useWalletStore()
const { otp, sendOTP, confirmTransfer } = useTransfer()

const currentStep = ref(1)
const resendCountdown = ref(0)

const handleNext = async () => {
  if (!(await sendOTP())) return
  currentStep.value = 2
}

const handleVerifyOTP = async () => {
  if (await confirmTransfer()) {
    currentStep.value = 4
  }
}

const handleResendOTP = async () => {
  resendCountdown.value = 30
  const timer = setInterval(() => {
    resendCountdown.value--
    if (resendCountdown.value <= 0) clearInterval(timer)
  }, 1000)
  await sendOTP()
}

const handleConfirm = async () => {
  await confirmTransfer()
  currentStep.value = 4
}

const handleCancel = () => {
  transferStore.resetForm()
  currentStep.value = 1
}

const handleNewTransfer = () => {
  transferStore.resetForm()
  currentStep.value = 1
}

const handleRetry = () => {
  currentStep.value = 1
}
</script>

<style scoped>
.transfer-page {
  max-width: 500px;
  margin: 0 auto;
  padding: 20px;
}

.error-message {
  background: #fee;
  color: #c33;
  padding: 12px;
  border-radius: 4px;
  margin-bottom: 20px;
}

.form-group {
  margin-bottom: 16px;
}

.form-group label {
  display: block;
  margin-bottom: 6px;
  font-weight: 500;
}

.form-group input,
.form-group textarea {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
}

.form-group small {
  display: block;
  margin-top: 4px;
  color: #666;
}

.btn-primary,
.btn-secondary {
  padding: 12px 20px;
  border: none;
  border-radius: 4px;
  font-weight: 500;
  cursor: pointer;
  margin-right: 8px;
}

.btn-primary {
  background: #007bff;
  color: white;
}

.btn-primary:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.btn-secondary {
  background: #f0f0f0;
  color: #333;
}

.confirm-section,
.result-section {
  text-align: center;
}

.success,
.failure {
  padding: 40px 20px;
}

.success .icon {
  font-size: 60px;
  margin-bottom: 20px;
}

.success h2 {
  color: #28a745;
  margin-bottom: 10px;
}

.failure .icon {
  font-size: 60px;
  margin-bottom: 20px;
}

.failure h2 {
  color: #dc3545;
  margin-bottom: 10px;
}
</style>
```

---

## ç¬¬åç« ï¼šæ”¯ä»˜ç³»ç»Ÿçš„æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

```typescript
// src/features/transaction/composables/__tests__/useTransfer.test.ts
import { describe, it, expect, vi, beforeEach } from 'vitest'
import { useTransfer } from '../useTransfer'
import { useTransferStore } from '../../stores/transferStore'
import { useWalletStore } from '../../../wallet/stores/walletStore'

describe('useTransfer', () => {
  let transferStore: any
  let walletStore: any

  beforeEach(() => {
    vi.clearAllMocks()
    transferStore = useTransferStore()
    walletStore = useWalletStore()

    // åˆå§‹åŒ–storeæ•°æ®
    transferStore.state.recipientId = '9876543210'
    transferStore.state.amount = 1000
    walletStore.state.balance = 10000
  })

  it('åº”è¯¥éªŒè¯ä½™é¢å……è¶³', async () => {
    const { validateTransfer } = useTransfer()
    const result = await validateTransfer()
    expect(result).toBe(true)
  })

  it('åº”è¯¥æ‹’ç»ä½™é¢ä¸è¶³çš„è½¬è´¦', async () => {
    walletStore.state.balance = 500
    const { validateTransfer } = useTransfer()
    const result = await validateTransfer()
    expect(result).toBe(false)
    expect(transferStore.state.error).toContain('ä½™é¢ä¸è¶³')
  })

  it('åº”è¯¥éªŒè¯KYCé™é¢', async () => {
    transferStore.state.amount = 200000 // è¶…è¿‡tier1é™é¢
    const { validateTransfer } = useTransfer()
    const result = await validateTransfer()
    expect(result).toBe(false)
    expect(transferStore.state.error).toContain('KYCç­‰çº§')
  })
})
```

### E2Eæµ‹è¯• (ä½¿ç”¨Playwright)

```typescript
// tests/e2e/transfer.spec.ts
import { test, expect } from '@playwright/test'

test.describe('è½¬è´¦æµç¨‹', () => {
  test.beforeEach(async ({ page }) => {
    // ç™»å½•
    await page.goto('http://localhost:5173/login')
    await page.fill('input[type="text"]', 'testuser@example.com')
    await page.fill('input[type="password"]', 'password123')
    await page.click('button:has-text("ç™»å½•")')
    await page.waitForURL('http://localhost:5173/wallet')
  })

  test('å®Œæ•´çš„è½¬è´¦æµç¨‹', async ({ page }) => {
    // å¯¼èˆªåˆ°è½¬è´¦é¡µé¢
    await page.click('a:has-text("è½¬è´¦")')
    await expect(page).toHaveURL(/.*transfer/)

    // æ­¥éª¤1: è¾“å…¥æ”¶æ¬¾äººå’Œé‡‘é¢
    await page.fill('input[placeholder*="è´¦æˆ·"]', '9876543210')
    await page.fill('input[placeholder*="é‡‘é¢"]', '1000')
    await page.click('button:has-text("ä¸‹ä¸€æ­¥")')

    // æ­¥éª¤2: ç­‰å¾…OTPé¡µé¢
    await expect(page.locator('text=éªŒè¯ç ')).toBeVisible()

    // è¾“å…¥OTP (æ¨¡æ‹ŸOTP)
    const otpInput = page.locator('input[placeholder*="éªŒè¯ç "]')
    await otpInput.fill('123456')
    await page.click('button:has-text("éªŒè¯")')

    // æ­¥éª¤3: ç¡®è®¤è½¬è´¦
    await expect(page.locator('text=ç¡®è®¤è½¬è´¦')).toBeVisible()
    await page.click('button:has-text("ç¡®è®¤è½¬è´¦")')

    // æ­¥éª¤4: æˆåŠŸæç¤º
    await expect(page.locator('text=è½¬è´¦æˆåŠŸ')).toBeVisible()
    const txId = await page.locator('text=äº¤æ˜“ID').textContent()
    expect(txId).toMatch(/[0-9a-f]{32}/)
  })

  test('åº”è¯¥æ‹’ç»ä½™é¢ä¸è¶³çš„è½¬è´¦', async ({ page }) => {
    await page.click('a:has-text("è½¬è´¦")')
    await page.fill('input[placeholder*="è´¦æˆ·"]', '9876543210')
    await page.fill('input[placeholder*="é‡‘é¢"]', '50000') // è¶…è¿‡ä½™é¢
    await page.click('button:has-text("ä¸‹ä¸€æ­¥")')

    await expect(page.locator('text=ä½™é¢ä¸è¶³')).toBeVisible()
  })
})
```

---

## ç¬¬åä¸€ç« ï¼šç”Ÿäº§éƒ¨ç½²æ¸…å•

### éƒ¨ç½²å‰çš„å®‰å…¨æ£€æŸ¥

```
â˜‘ï¸ å®‰å…¨æ€§æ£€æŸ¥
  â˜ æ‰€æœ‰APIè¯·æ±‚éƒ½ä½¿ç”¨HTTPS
  â˜ æ²¡æœ‰æ•æ„Ÿæ•°æ®åœ¨localStorageæˆ–consoleä¸­
  â˜ æœ‰æ•ˆçš„CSP (Content Security Policy)
  â˜ X-Frame-Optionsè®¾ç½®ä¸ºDENYæˆ–SAMEORIGIN
  â˜ X-Content-Type-Optionsè®¾ç½®ä¸ºnosniff
  â˜ å®æ–½CORSç™½åå•
  â˜ ä¾èµ–åŒ…æ— å·²çŸ¥æ¼æ´ (npm audit)
  â˜ å®Œæ•´çš„é”™è¯¯è¾¹ç•Œå¤„ç†

â˜‘ï¸ æ€§èƒ½æ£€æŸ¥
  â˜ Lighthouseæ€§èƒ½è¯„åˆ† > 90
  â˜ Bundleå¤§å° < 500KB (gzipped)
  â˜ LCP < 2.5s
  â˜ FID < 100ms
  â˜ CLS < 0.1
  â˜ å¯ç”¨äº†Service Worker
  â˜ æ‰€æœ‰å…³é”®èµ„æºé¢„åŠ è½½
  â˜ å›¾ç‰‡ä¼˜åŒ–å’Œæ‡’åŠ è½½

â˜‘ï¸ å¯ç”¨æ€§æ£€æŸ¥
  â˜ ç¦»çº¿æ¨¡å¼å¯ç”¨
  â˜ ç½‘ç»œé”™è¯¯æ—¶æœ‰é€‚å½“çš„é™çº§æ–¹æ¡ˆ
  â˜ æ‰€æœ‰å…³é”®æµç¨‹éƒ½æœ‰é‡è¯•æœºåˆ¶
  â˜ ç”¨æˆ·åé¦ˆå’ŒåŠ è½½çŠ¶æ€æ¸…æ™°

â˜‘ï¸ åˆè§„æ€§æ£€æŸ¥
  â˜ PCI-DSSåˆè§„æ€§å®¡è®¡é€šè¿‡
  â˜ RBIæ•°æ®æœ¬åœ°åŒ–è¦æ±‚æ»¡è¶³
  â˜ GDPRéšç§æ”¿ç­–å°±ä½
  â˜ æœåŠ¡æ¡æ¬¾å’Œé£é™©æŠ«éœ²
  â˜ å®¡è®¡æ—¥å¿—ç³»ç»Ÿå®Œæ•´
```

---

## ç¬¬åäºŒç« ï¼šå¸¸è§é—®é¢˜ä¸æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: å¦‚ä½•å¤„ç†æ”¯ä»˜ä¸­çš„ç½‘ç»œä¸­æ–­ï¼Ÿ**

A: ä½¿ç”¨ç¦»çº¿é˜Ÿåˆ—ï¼ˆè§ç¬¬å…­ç« ï¼‰ã€‚ç”¨æˆ·çš„æ”¯ä»˜è¯·æ±‚è¢«ç¼“å­˜ï¼Œå½“ç½‘ç»œæ¢å¤æ—¶è‡ªåŠ¨é‡è¯•ã€‚ç¡®ä¿ä½¿ç”¨å¹‚ç­‰æ€§Keyé˜²æ­¢é‡å¤æ‰£æ¬¾ã€‚

**Q: OTPéªŒè¯å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ**

A: OTPå¯èƒ½è¿‡æœŸï¼ˆé€šå¸¸5åˆ†é’Ÿï¼‰ã€‚æä¾›"é‡æ–°å‘é€"é€‰é¡¹ï¼Œä½†é™åˆ¶é¢‘ç‡ï¼ˆå¦‚30ç§’å†·å´æ—¶é—´ï¼‰ã€‚

**Q: ç”¨æˆ·æŠ•è¯‰æ”¯ä»˜è¢«æ‰£äº†ä¸¤æ¬¡ï¼Ÿ**

A: æ£€æŸ¥å¹‚ç­‰æ€§Keyå®ç°ã€‚å¦‚æœKeyæœªæ­£ç¡®ä¼ é€’ï¼Œåç«¯å¯èƒ½ä¼šå¤„ç†é‡å¤è¯·æ±‚ã€‚åŒæ—¶æ£€æŸ¥ç½‘ç»œé‡è¯•çš„é¢‘ç‡ã€‚

**Q: æ”¯ä»˜è¡¨å•åœ¨ä½ç½‘ç»œé€Ÿåº¦ä¸‹åŠ è½½ç¼“æ…¢ï¼Ÿ**

A: å¯ç”¨Service Workerç¼“å­˜ï¼Œä½¿ç”¨å›¾ç‰‡ä¼˜åŒ–å’Œä»£ç åˆ†å‰²ï¼ˆè§ç¬¬å…«ç« ï¼‰ã€‚è€ƒè™‘é¢„åŠ è½½æ”¯ä»˜è¡¨å•ã€‚

### æ€§èƒ½è°ƒè¯•

```typescript
// ä½¿ç”¨ Performance API æµ‹é‡å…³é”®æ“ä½œ
const measurePaymentTime = async () => {
  const startMark = performance.now()

  try {
    await confirmTransfer()
  } finally {
    const endMark = performance.now()
    const duration = endMark - startMark

    console.log(`æ”¯ä»˜è€—æ—¶: ${duration.toFixed(2)}ms`)

    // ä¸ŠæŠ¥åˆ°åˆ†ææœåŠ¡
    analytics.event('payment_duration', { duration })

    // å¦‚æœè¶…è¿‡é¢„æœŸï¼Œå‘é€å‘Šè­¦
    if (duration > 5000) {
      alerting.warn('æ”¯ä»˜å¤„ç†ç¼“æ…¢', { duration })
    }
  }
}
```

---

## ç¬¬åä¸‰ç« ï¼šæ€»ç»“ä¸æœ€ä½³å®è·µ

### æ”¯ä»˜å¹³å°å‰ç«¯çš„æ ¸å¿ƒè¦ç‚¹

1. **å®‰å…¨ç¬¬ä¸€** - PCI-DSSåˆè§„ä¸æ˜¯å¯é€‰çš„ï¼Œæ˜¯å¿…é¡»çš„
2. **ç”¨æˆ·ä½“éªŒ** - å³ä½¿åœ¨ä½ç½‘ç»œæ¡ä»¶ä¸‹ä¹Ÿè¦ä¿æŒæµç•…
3. **å¯é æ€§** - ç¦»çº¿æ”¯æŒã€é‡è¯•æœºåˆ¶ã€é”™è¯¯å¤„ç†æ— å¤„ä¸åœ¨
4. **å¯ç»´æŠ¤æ€§** - æ¨¡å—åŒ–æ¶æ„ã€æ¸…æ™°çš„çŠ¶æ€ç®¡ç†ã€å…¨é¢çš„æµ‹è¯•
5. **å¯æ‰©å±•æ€§** - æ”¯æŒæ–°çš„æ”¯ä»˜æ–¹å¼ã€æ–°çš„å¸‚åœºã€æ–°çš„åŠŸèƒ½

### å¿…è¯»èµ„æº

- [OWASP å‰ç«¯å®‰å…¨TOP 10](https://owasp.org/www-project-top-10/)
- [PCI DSS è¦æ±‚](https://www.pcisecuritystandards.org/)
- [RBIæ”¯ä»˜ç³»ç»Ÿè§„å®š](https://www.rbi.org.in/)
- [NPCI UPIæ ‡å‡†](https://www.npci.org.in/)

### ä¸‹ä¸€æ­¥

å½“Claudeè°ƒç”¨è¿™ä¸ªSkillæ—¶ï¼Œå®ƒå°†èƒ½å¤Ÿï¼š

1. **åˆå§‹åŒ–é¡¹ç›®** - ä½¿ç”¨æä¾›çš„è„šæœ¬ç”Ÿæˆé¡¹ç›®ç»“æ„
2. **è®¾è®¡æ¶æ„** - å‚è€ƒç« èŠ‚äºŒçš„é¡¹ç›®ç»“æ„å»ºè®®
3. **å®ç°åŠŸèƒ½** - æŸ¥çœ‹è¯¦ç»†çš„ä»£ç ç¤ºä¾‹å’Œæœ€ä½³å®è·µ
4. **ç¡®ä¿å®‰å…¨** - éµå¾ªç¬¬ä¸‰ç« çš„å®‰å…¨æŒ‡å—
5. **ä¼˜åŒ–æ€§èƒ½** - åº”ç”¨ç¬¬å…«ç« çš„ä¼˜åŒ–ç­–ç•¥
6. **æµ‹è¯•å’Œéƒ¨ç½²** - ä½¿ç”¨è„šæœ¬å·¥å…·è¿›è¡Œè‡ªåŠ¨åŒ–æ£€æŸ¥

---

## é™„å½•ï¼šå…³é”®æ¦‚å¿µé€ŸæŸ¥

| æ¦‚å¿µ | è¯´æ˜ | ç« èŠ‚ |
|------|------|------|
| **PCI-DSS** | æ”¯ä»˜å¡äº§ä¸šæ•°æ®å®‰å…¨æ ‡å‡† | ç¬¬ä¸‰ã€åç«  |
| **KYC** | äº†è§£ä½ çš„å®¢æˆ· | ç¬¬å››ã€äº”ç«  |
| **OTP** | ä¸€æ¬¡æ€§å¯†ç ï¼ˆçŸ­ä¿¡éªŒè¯ç ï¼‰ | ç¬¬å››ã€äº”ç«  |
| **å¹‚ç­‰æ€§** | åŒæ ·è¯·æ±‚é‡å¤è°ƒç”¨ä¸å˜ | ç¬¬äº”ç«  |
| **çŠ¶æ€æœº** | å®šä¹‰æœ‰é™çš„çŠ¶æ€å’Œè½¬æ¢ | ç¬¬å››ã€äº”ç«  |
| **ç¦»çº¿ä¼˜å…ˆ** | å‡è®¾ç½‘ç»œç¦»çº¿ï¼Œç¼“å­˜å’ŒåŒæ­¥ | ç¬¬å…­ç«  |
| **ä¹è§‚æ›´æ–°** | å…ˆæ›´æ–°UIï¼Œåç¡®è®¤æœåŠ¡å™¨ | ç¬¬äº”ç«  |
| **WebSocket** | åŒå‘å®æ—¶é€šä¿¡ | ç¬¬äº”ç«  |
| **Service Worker** | æµè§ˆå™¨åå°å·¥ä½œè¿›ç¨‹ï¼Œç”¨äºç¼“å­˜ | ç¬¬å…­ã€å…«ç«  |
| **Lighthouse** | Googleçš„ç½‘ç«™è´¨é‡å®¡è®¡å·¥å…· | ç¬¬å…«ã€åä¸€ç«  |

---

**è¿™æ˜¯ä¸€ä»½å®Œæ•´çš„å°åº¦æ”¯ä»˜å¹³å°å‰ç«¯å¼€å‘æŒ‡å—ã€‚Claudeåœ¨è°ƒç”¨æ­¤Skillæ—¶ï¼Œå°†å…·å¤‡æ„å»ºç”Ÿäº§çº§æ”¯ä»˜ç³»ç»Ÿæ‰€éœ€çš„æ‰€æœ‰çŸ¥è¯†ã€‚**
