# Claude 自动修复 Bug - 快速参考

> 一页纸掌握 Claude Bug 修复的核心要点 | 版本 2.0 | 最后更新 2025-11-13

---

## ⚡ 30 秒速览

**目标**: 使用 Claude AI 自动分析和修复代码 Bug

**3 个步骤**:
1. 提供完整的 Bug 描述（10 个必需要素）
2. Claude 执行 7 阶段分析工作流
3. 获得专业的修复报告和代码

---

## 🛠️ 工具命令速查

```bash
# 基础命令
fix-bug-with-codex <file> --language <lang>

# 完整示例
fix-bug-with-codex app.py --language python --detailed --output report.md

# 常用选项
--language python/js/rust/...    # 编程语言
--line 45                         # Bug 所在行号
--context 10                      # 上下文行数（前后各 N 行）
--detailed                        # 生成详细报告
--output report.md               # 输出文件
--model claude-opus              # Claude 模型
--temperature 0.2                # 创意度（0.0-1.0）
```

---

## 📋 Bug 描述 10 要素清单（必填）

```
✅ 1. Bug 标题         - 简洁准确的摘要（50 字以内）
✅ 2. 问题描述         - Bug 表现形式和影响
✅ 3. 复现步骤         - 分步说明如何重现
✅ 4. 预期行为         - 如果正常应该发生什么
✅ 5. 实际行为         - 当前系统实际做了什么
✅ 6. 环境信息         - OS、浏览器、版本号
✅ 7. 错误日志         - 完整的堆栈跟踪
✅ 8. 代码片段         - 相关代码（10-20 行）
✅ 9. 影响范围         - 受影响用户、严重等级
✅ 10. 附加信息        - 相关 Issue、临时解决方案
```

### 模板速写

```markdown
## Bug 标题
登录页面在 Safari 中提交后无响应，显示 CORS 错误

## 问题描述
用户点击登录按钮后...

## 复现步骤
1. 打开登录页面
2. 输入凭证
3. 点击登录
4. 观察页面无反应

## 预期行为
显示加载动画，跳转到仪表板

## 实际行为
页面无反应，控制台报 CORS 错误

## 环境
OS: macOS 14.1 | Browser: Safari 17.1 | Node: v20.9.0

## 错误日志
Cross-Origin Request Blocked: The Same Origin Policy disallows...

## 代码片段
[20行代码，标注问题行]

## 影响范围
所有 Safari 用户无法登录 | 严重等级: CRITICAL

## 附加信息
相关: #1234 | 临时方案: 使用 Chrome
```

---

## 🔄 Claude 7 阶段工作流程

```
Stage 1: 问题分析     → 读取 Bug 描述，提取关键信息
Stage 2: 代码定位     → 找到问题代码的确切位置
Stage 3: 根本原因分析 → 为什么会出现这个问题
Stage 4: 方案设计     → 提出 2-3 个修复方案
Stage 5: 代码实现     → 生成修复代码（带注释）
Stage 6: 测试设计     → 编写单元测试和集成测试
Stage 7: 生成报告     → 输出结构化的修复报告
```

### 每阶段输出

| 阶段 | 输出内容 | 关键点 |
|------|---------|--------|
| **1** | Bug 摘要、关键信息、初步推断 | 完整理解问题 |
| **2** | 代码位置、调用链、依赖关系 | 准确定位 |
| **3** | 根本原因、潜在相关问题 | 深入分析 |
| **4** | 多个方案 + 优缺点分析 | 全面评估 |
| **5** | 修复代码 + 详细注释 | 可直接使用 |
| **6** | 单元测试 + 集成测试用例 | 充分验证 |
| **7** | 完整报告 + 部署指导 | 正式交付 |

---

## 📄 修复报告关键章节

```markdown
# Bug 修复报告

## Executive Summary (1-2 段)
问题和解决方案的简明总结

## 问题分析
- 原始描述
- 根本原因
- 影响范围

## 修复方案
- 推荐方案（含优缺点）
- 替代方案

## 实现细节
- 第一步：修改 A 文件
- 第二步：修改 B 文件
- ...

## 测试验证
- 单元测试代码
- 手动测试清单
  - [ ] 场景 1
  - [ ] 场景 2
  - [ ] ...

## 部署指导
1. 代码审查
2. 测试环境验证
3. 灰度部署（5% 用户）
4. 监控指标
5. 全量部署

## 回滚计划
git revert <commit>

## 后续行动
- [ ] 收集用户反馈
- [ ] 更新文档
- [ ] 监控相关指标
```

---

## ⭐ 10 个最佳实践速记

| # | 实践 | 说明 |
|---|------|------|
| 1 | 完整描述 | 提供所有 10 个必需要素 |
| 2 | 代码上下文 | 提供足够的前后代码（10-20 行） |
| 3 | 环境信息 | 明确列出所有版本信息 |
| 4 | 分步复现 | 任何人都能按步骤重现问题 |
| 5 | 多方案评估 | 不要只要第一个方案 |
| 6 | 充分测试 | 编写单元测试和集成测试 |
| 7 | 文档记录 | 更新代码注释和文档 |
| 8 | 渐进部署 | 灰度部署后再全量 |
| 9 | 用户沟通 | 通知受影响的用户 |
| 10 | 后续跟进 | 部署后 48 小时重点监控 |

---

## ❌ 10 个常见陷阱速记

| # | 陷阱 | 正确做法 |
|----|------|---------|
| 1 | 不完整的描述 | 使用 10 要素模板 |
| 2 | 缺少代码片段 | 提供相关代码（保护敏感信息） |
| 3 | 不指定环境 | 明确列出 OS、浏览器、版本 |
| 4 | 仓促部署 | 测试 → 灰度 → 全量 |
| 5 | 忽视类似问题 | 检查是否有相关问题 |
| 6 | 无回滚计划 | 准备好快速回滚命令 |
| 7 | 忽视用户体验 | 主动通知用户 |
| 8 | 过度工程化 | 最小化修改，只修复问题 |
| 9 | 不更新文档 | 同时更新代码和文档 |
| 10 | 忽视监控 | 部署后 24-48 小时重点监控 |

---

## 🎯 实战快速路径

### 场景 1：快速修复 (15 分钟)
```
1. 提供 10 要素 Bug 描述
2. Claude 分析和修复
3. 运行推荐的测试
4. 部署到测试环境
```

### 场景 2：深度分析 (1 小时)
```
1. 完整 Bug 描述 + 代码
2. Claude 7 阶段分析
3. 多方案对比和评估
4. 生成完整修复报告
5. 提供测试用例和部署指导
```

### 场景 3：团队流程建立 (半天)
```
1. 培训团队成员理解 10 要素
2. 建立 Bug 描述模板
3. 建立修复报告规范
4. 在项目中试用工作流
5. 收集反馈并优化流程
```

---

## 📊 检查清单

### 提交 Bug 描述前
- [ ] 包含 10 个必需要素
- [ ] 代码片段清晰（标注行号）
- [ ] 环境信息完整
- [ ] 复现步骤清晰
- [ ] 错误日志完整

### 收到修复报告后
- [ ] 理解根本原因分析
- [ ] 评估所有提议的方案
- [ ] 检查生成的测试用例
- [ ] 在测试环境验证修复
- [ ] 准备部署和回滚计划

### 部署前
- [ ] 代码审查通过
- [ ] 所有测试绿色
- [ ] 准备好回滚命令
- [ ] 通知相关团队成员
- [ ] 准备用户通知信息

### 部署后
- [ ] 监控关键指标（24-48 小时）
- [ ] 收集用户反馈
- [ ] 验证问题确实已解决
- [ ] 更新文档和知识库
- [ ] 记录类似问题的防护措施

---

## 🔗 相关链接

| 资源 | 链接 |
|------|------|
| 完整指南 | 见 SKILL.md |
| 使用指南 | 见 USAGE-GUIDE.md |
| MDN CORS | https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS |
| Claude API | https://claude.ai/docs |
| GitHub 仓库 | https://github.com/sanshao85/persistent-terminal-mcp |

---

## 💡 记住这 5 点

1. **完整的描述** → 提供 10 要素，让 Claude 充分理解
2. **系统的分析** → 遵循 7 阶段工作流，不要跳步
3. **多方案评估** → 不要只看第一个方案
4. **充分的测试** → 写测试，验证修复，防止回归
5. **谨慎的部署** → 灰度部署，监控指标，准备回滚

---

**快速开始**: 提供完整的 Bug 描述 → 运行 `fix-bug-with-codex` → 获得修复方案 → 遵循部署指导 → 监控效果

**需要帮助?** 详见完整的 SKILL.md 和 USAGE-GUIDE.md

---

版本: 2.0 | 最后更新: 2025-11-13 | Claude AI Development Team
