# Code Review 检查清单

> 高效、专业的代码审查标准（参考 Google 和 Meta 的实践）

## 前置条件

- [ ] PR 标题清晰，描述了变更的目的
- [ ] PR 关联了相关的 Issue
- [ ] CI/CD 所有检查都通过
- [ ] 没有冲突的分支

---

## 🔴 必须通过（Critical）

### 功能正确性

- [ ] 代码实现了 PR 描述的需求
- [ ] 没有逻辑错误或边界情况的遗漏
- [ ] 错误处理完善（try-catch 等）
- [ ] 特殊情况都有处理（null 检查、edge cases）

### 类型安全（TypeScript）

- [ ] 没有使用 `any` 类型（或有特别说明）
- [ ] 所有函数参数都有类型注解
- [ ] 所有函数返回值都有类型注解
- [ ] 接口/类型定义清晰准确

### 安全性

- [ ] 没有 XSS 漏洞（用户输入被转义）
- [ ] 没有 CSRF 漏洞（POST 需要 CSRF token）
- [ ] 敏感信息不在代码中硬编码（密钥、密码）
- [ ] SQL 注入风险已消除（使用参数化查询）
- [ ] 依赖更新没有已知安全漏洞

### 测试覆盖

- [ ] 关键业务逻辑有单元测试
- [ ] 测试覆盖率 >= 80%
- [ ] 边界情况有测试
- [ ] 集成测试通过

---

## 🟡 应该通过（Important）

### 代码质量

- [ ] 代码遵循项目的编码规范（ESLint 检查通过）
- [ ] 函数长度合理（单个函数 < 100 行）
- [ ] 复杂度合理（圈复杂度 < 10）
- [ ] 避免深层嵌套（超过 3 层）
- [ ] 没有重复代码（DRY 原则）

### 可读性

- [ ] 变量名清晰有意义
- [ ] 函数名准确反映功能
- [ ] 复杂逻辑有注释说明
- [ ] 避免魔法数字（应该用常量）
- [ ] 代码格式化一致（Prettier 通过）

### 性能

- [ ] 没有明显的性能问题
- [ ] 算法复杂度合理
- [ ] 避免不必要的重排（layout thrashing）
- [ ] React/Vue 组件没有过度渲染
- [ ] 没有内存泄漏风险

### 可维护性

- [ ] 代码结构清晰，易于理解
- [ ] 遵循项目的设计模式
- [ ] 没有过度的抽象或复杂设计
- [ ] 依赖关系明确
- [ ] 易于单元测试

---

## 💡 可以改进（Nice to Have）

### 最佳实践

- [ ] 考虑 SOLID 原则
- [ ] 可以进一步优化性能
- [ ] 有更优雅的实现方式

### 文档

- [ ] 在 PR 描述中补充变更说明
- [ ] 在复杂代码处添加文档
- [ ] 如果是新 API，补充使用示例

### 错误处理

- [ ] 考虑添加更详细的错误信息
- [ ] 考虑添加用户友好的错误提示

---

## 📋 按类型分类的检查项

### React / Vue 组件审查

- [ ] Props 定义完整，有默认值
- [ ] 组件是否合理分解
- [ ] Hooks 依赖数组正确（useEffect）
- [ ] 没有在条件语句中使用 Hooks
- [ ] 避免在 JSX 中创建新函数/对象（每次渲染都会重新创建）

```javascript
// ❌ 坏做法：useEffect 中没有依赖数组
useEffect(() => {
  fetchData();
});

// ✅ 好做法
useEffect(() => {
  fetchData();
}, []);

// ❌ 坏做法：在 JSX 中创建新对象
<Component style={{ color: 'red' }} />

// ✅ 好做法
const style = { color: 'red' };
<Component style={style} />
```

### API / 后端接口

- [ ] 错误处理完善（400、401、403、500 等）
- [ ] 响应数据结构清晰
- [ ] 输入参数验证完整
- [ ] 使用 POST/PUT/DELETE（而不是 GET 进行数据修改）
- [ ] 速率限制已设置

### 数据库相关

- [ ] 没有 N+1 查询问题
- [ ] 索引设置合理
- [ ] 事务隔离级别正确
- [ ] 没有死锁风险

### 配置和环境

- [ ] 环境变量配置正确
- [ ] 不同环境的配置区分清晰
- [ ] 敏感信息不在代码库中

---

## 🎯 Review 评分标准

| 评分 | 含义 | 建议 |
|------|------|------|
| ✅ Approve | 可以合并 | 代码质量良好，没有阻塞问题 |
| 💬 Comment | 需要讨论 | 提出改进建议，但不阻塞合并 |
| ❌ Request Changes | 必须修改 | 存在必须解决的问题 |

---

## 📝 优秀 Review 的 7 个习惯

1. **准时反馈**（< 24 小时）
2. **具体指出问题**（说清楚为什么，怎么改进）
3. **尊重作者**（认可做得好的地方）
4. **教学导向**（帮助作者学习）
5. **不纠缠细节**（自动化工具处理 lint/format）
6. **承认自己的不确定**（"我不确定，但..."）
7. **快速决策**（不要过度审查）

---

## 🔗 相关资源

- [Google Code Review 标准](https://google.github.io/eng-practices/review/)
- [Meta 代码审查指南](https://www.internalfb.com/intern/wiki/Code_review_guide/)
- [Conventional Comments](https://conventionalcomments.org/)
